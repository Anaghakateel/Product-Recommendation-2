<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Telecom B2C — Mobile Prototype</title>
    <style>
      :root {
        --bg:#f7f8fb; --ink:#0b1324; --muted:#51607f; --line:#cfd8e3;
        --primary:#401075; --primary-ink:#fff; --chip:#ffffff; --chip-line:#401075;
        --success-bg:#eafff0; --success-line:#9feab9; --success-ink:#1a7f3c;
      }
      html, body { margin:0; height:100%; background:var(--bg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      .app { display:flex; align-items:center; justify-content:center; min-height:100vh; padding:20px; }
      .phone { width:380px; height:820px; border:2px solid #1f2a44; border-radius:28px; background:#fff; overflow-y:auto; overflow-x:hidden; -webkit-overflow-scrolling:touch; position:relative; }
      header { padding:16px 20px 8px; font-weight:600; color:var(--ink); }
      .screen { display:none; height:100%; }
      .screen.active { display:block; }
      .content { padding:0 20px 12px; }
      .muted { color:var(--muted); font-size:12px; }
      .chip { display:inline-block; padding:6px 10px; border:1px solid var(--chip-line); background:var(--chip); border-radius:9999px; font-size:11px; color:#401075; margin:4px 6px 0 0; }
      .card { border:1px solid var(--line); border-radius:12px; padding:16px; margin:10px 0; box-shadow:2px 2px 12px rgba(11,19,36,.12); }
      .plan { font-weight:600; color:var(--ink); font-size:14px; }
      .price { font-weight:700; color:var(--ink); }
      .feat { color:var(--muted); font-size:12px; }
      .elig { display:inline-block; background:var(--success-bg); color:var(--success-ink); border:1px solid var(--success-line); border-radius:8px; padding:4px 8px; font-size:11px; }
      .cta { display:inline-block; background:var(--primary); color:var(--primary-ink); border:1px solid var(--primary); border-radius:9999px; padding:10px 14px; font-weight:500; font-size:16px; height:50px; width:100%; cursor:pointer; box-shadow:2px 2px 12px rgba(64,16,117,.30); }
      .cta-secondary { display:inline-block; background:#ffffff; color:#401075; border:1px solid #401075; border-radius:9999px; padding:10px 12px; font-weight:400; font-size:16px; height:50px; width:100%; cursor:pointer; box-shadow:2px 2px 10px rgba(11,19,36,.12); }
      .stack { display:flex; gap:10px; flex-wrap:wrap; }
      .sticky { position:sticky; left:0; right:0; bottom:0; padding:12px 16px; border-top:1px solid var(--line); background:rgba(255,255,255,.96); display:flex; gap:10px; }
      /* Only show Co‑Design sticky when that screen is active */
      .cd-sticky { display:none; }
      #screen-codesign.active .cd-sticky { display:flex; }
      input[type="text"], input[type="date"], input[type="time"], select, textarea {
        width:100%; padding:12px 12px; border:1px solid var(--line); border-radius:10px; font-size:14px; box-sizing: border-box;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--ink);
      }
      input[type="range"] { width:100%; }
      /* Selected checkbox brand color */
      input[type="checkbox"]:checked { accent-color:#401075; }
      .row { display:flex; gap:10px; }
      .row > * { flex:1; }
      .subtle { font-size:11px; color:#6b7b9b; }
      .center { text-align:center; }
      .divider { height:1px; background:var(--line); margin:12px 0; }
      /* range helpers */
      .range-wrap { position:relative; }
      .range-tip { position:absolute; right:0; top:-2px; font-weight:700; font-size:12px; color:var(--ink); }
      .drawer { position:absolute; left:0; right:0; bottom:0; background:#fff; border-top:2px solid #1f2a44; border-radius:16px 16px 0 0; padding:14px; box-shadow:0 -20px 60px rgba(0,0,0,.25); }
      .overlay { position:absolute; inset:0; background:rgba(11,19,36,.25); }
      .hidden { display:none; }
      .stars { color:#f59e0b; font-size:20px; }
      .toolbar { display:flex; gap:8px; flex-wrap:wrap; }
      .sr-only { position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }
      .link { color:#401075; font-weight:600; cursor:pointer; }
      /* placeholders match base font */
      input::placeholder, textarea::placeholder {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        font-size: 12px;
        color: var(--muted);
        opacity: 1;
      }
      /* explicit system-ui placeholder for the welcome textarea */
      #welcomeSearch::placeholder {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }
      /* welcome textarea width */
      #welcomeSearch { width:95%; }
      /* welcome */
      .hero { width:104px; height:104px; border-radius:52px; background:#eef2ff; margin:32px auto; display:flex; align-items:center; justify-content:center; box-shadow:0 12px 24px rgba(11,19,36,.20); }
      .hero-icon { width:56px; height:56px; border-radius:28px; border:6px solid var(--primary); box-sizing:border-box; position:relative; }
      .hero-icon::after, .hero-icon::before { content:""; position:absolute; border:6px solid var(--primary); border-radius:999px; inset:-14px; }
      .hero-icon::before { inset:-28px; opacity:.35; }
      .dots { display:flex; gap:10px; justify-content:center; margin:16px 0 0; }
      .dot { width:8px; height:8px; border-radius:4px; background:#cfe0ff; }
      .dot.active { background:#401075; }
      .chip-toggle.selected { background:#401075; color:#ffffff; border-color:#401075; }
      /* Welcome chips: make text white + drop shadow */
      /* Basics chips: make text white */
      .cta-md { padding:8px 12px; font-size:14px; }
      .link-sm { font-size:13px; }
      .cta-lg { padding:14px 16px; font-size:16px; }
      .chip-toggle { font-size:13px; padding:8px 12px; position:relative; border-radius:9999px; }
      .req { color:#d92c20; margin-left:4px; font-weight:700; }
      /* Match screen chips: white bg, brand text, keep outline */
      #screen-match #matchChips .chip, #screen-match #matchChips .chip-toggle { background:#ffffff; color:#401075; border-color:#401075; }
      /* address screen styles */
      .display-h1 { font-weight:800; font-size:28px; text-align:center; color:var(--ink); margin:14px 16px 8px; }
      .subhead { text-align:center; color:#51607f; font-size:14px; margin:0 24px 18px; }
      .image-hero { height:240px; border-radius:14px; background:url('./assets/GradientBackground.svg') center/cover no-repeat; margin:12px 20px; box-shadow:0 8px 24px rgba(0,0,0,.08); }
      img.image-hero { display:block; border-radius:14px; margin:12px auto; box-shadow:0 8px 24px rgba(0,0,0,.08); max-width:100%; height:auto; }
      .input-with-icon { position:relative; }
      .input-with-icon .icon-left { position:absolute; left:12px; top:50%; transform:translateY(-50%); font-size:18px; color:#6b7b9b; }
      .input-with-icon input { padding-left:40px; }
      .btn-disabled { opacity:.6; pointer-events:none; }
      /* Disabled button color overrides - brand palette */
      .cta.btn-disabled { background:#E1DCE5 !important; border:1px solid #ACA6B1 !important; color:#ACA6B1 !important; opacity:1 !important; }
      .cta-secondary.btn-disabled { background:#C4B7D2 !important; border:1px solid #8D6FAD !important; color:#8D6FAD !important; opacity:1 !important; }
      /* Specific: Apply primary disabled styling to Ask AI button when disabled */
      #basicsAiBtn.btn-disabled { background:#E1DCE5 !important; border:1px solid #ACA6B1 !important; color:#ACA6B1 !important; }
      .success { color:#1a7f3c; font-size:13px; }
      .failure { color:#b91c1c; font-size:13px; }
      .address-top { background:url('./assets/GradientBackground.svg') center/cover no-repeat; padding-top:8px; padding-bottom:8px; margin-bottom:24px; }
      .address-top header, .address-top .plan { color:#401075 !important; }
      .address-top .muted { color:#ffffff !important; }
      /* Restore original muted color inside product card on Plan Full screen (override white) */
      #screen-plan-full .address-top .card .muted { color:var(--muted) !important; }
      .hero-address { width:104px; height:104px; border-radius:52px; background:#eef2ff; margin:16px auto 8px; display:flex; align-items:center; justify-content:center; }
      .hero-address img { width:64px; height:64px; object-fit:contain; }
      /* address inputs width */
      #screen-address input[type="text"] { width:90%; }
      /* two-column rows at 38% each */
      #screen-address .address-split > * { flex:0 0 38%; }
      #screen-address .address-split input[type="text"] { width:100%; }
      #screen-address .address-split { gap:10px; align-items:flex-start; justify-content:flex-start; }
      #screen-address .address-split label { white-space:nowrap; }
      /* numbered priority badge for multi-select order */
      .chip-toggle[data-rank]::after {
        content: attr(data-rank);
        position:absolute;
        top:-8px;
        right:-8px;
        width:20px;
        height:20px;
        border-radius:10px;
        background:#AE96CB;
        color:#fff;
        font-weight:700;
        font-size:12px;
        display:flex;
        align-items:center;
        justify-content:center;
        box-shadow:0 1px 2px rgba(0,0,0,.25);
        transform: scale(1);
        transition: transform 120ms ease;
      }
      #screen-welcome { background: #ffffff; }
      .welcome-top { background:url('./assets/GradientBackground.svg') center/cover no-repeat; padding-top:8px; padding-bottom:8px; }
      /* gradient sections typography */
      .welcome-top header, .welcome-top .plan { color:#401075 !important; }
      .welcome-top .muted { color:#ffffff !important; }
      .section-title { font-weight:500; color:#0b1324; font-size:14px; }
      .section-sub { font-size:12px; color:#51607f; margin:2px 0 8px; }
      #affinityNotes { width:90%; margin:0; }
      /* processing screen */
      #screen-processing { background:url('./assets/GradientBackground.svg') center/cover no-repeat; }
      #screen-processing header, #screen-processing .plan { color:#401075 !important; }
      #screen-processing .muted { color:#ffffff !important; }
      .ring {
        --p: 0; /* progress 0..100 */
        width:88px; height:88px; border-radius:44px;
        background:
          conic-gradient(var(--primary) calc(var(--p)*1%), #dbe8ff 0);
        display:inline-block; position:relative; margin:4px auto;
      }
      .ring::after {
        content:"";
        position:absolute; inset:8px; background:#eef6ff; border-radius:50%;
      }
      .ring-label {
        position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
        font-weight:700; color:var(--primary); font-size:14px;
      }
      .badge {
        display:inline-block; padding:6px 10px; border-radius:10px; border:1px solid; font-size:13px; margin-top:4px;
      }
      .badge.success { background:#eafff0; border-color:#9feab9; color:#1a7f3c; }
      .badge.failure { background:#ffe8ea; border-color:#ffc0c6; color:#b91c1c; }
      /* personalize (step 4) */
      #screen-personalize { background:#ffffff; }
      .option-chip { display:inline-block; padding:8px 12px; border:1px solid var(--chip-line); background:#fff; color:#2b3e66; border-radius:9999px; font-weight:600; cursor:pointer; }
      .option-chip.selected { background:var(--primary); border-color:#4a158a; color:#fff; }
      .range-row { display:flex; align-items:center; gap:10px; }
      .range-row input[type="range"] { flex:1; }
      .range-value { min-width:88px; text-align:right; font-weight:600; color:#0b1324; }
      /* iOS-like slider styling */
      .styled-range {
        -webkit-appearance:none; appearance:none; height:8px; border-radius:999px;
        background:
          linear-gradient(var(--primary) 0 0) 0/ var(--val,0%) 100% no-repeat,
          #e8eff8;
        outline:none;
      }
      .styled-range::-webkit-slider-thumb {
        -webkit-appearance:none; appearance:none;
        width:10px; height:10px; border-radius:50%;
        background:var(--primary); border:0;
        box-shadow:0 1px 2px rgba(0,0,0,.15);
        cursor:pointer;
        margin-top:-1px; /* centers thumb on 8px track */
      }
      .styled-range::-moz-range-thumb {
        width:10px; height:10px; border-radius:50%;
        background:var(--primary); border:0;
        box-shadow:0 1px 2px rgba(0,0,0,.15);
        cursor:pointer;
      }
      .styled-range::-moz-range-track {
        height:8px; border-radius:999px; background:#e8eff8;
      }
      /* linear progress for match screen */
      .progress-row { display:flex; align-items:center; justify-content:space-between; width:90%; margin:6px auto; max-width:520px; }
      .progress { width:90%; height:8px; background:#e6edf7; border-radius:999px; margin:6px auto 0; max-width:520px; }
      .progress-fill { height:8px; background:#401075; border-radius:999px; width:0%; transition:width .2s linear; }
      /* match screen */
      #screen-match { background:#ffffff; }
      /* recommended screen */
      .reco-top { background:url('./assets/GradientBackground.svg') center/cover no-repeat; padding-top:8px; padding-bottom:12px; }
      .reco-top header, .reco-top .plan { color:#401075 !important; }
      .reco-hero { display:block; margin:12px auto 6px; width:64px; height:64px; }
      .hscroll { display:flex; gap:10px; overflow-x:auto; padding:6px 0 10px; }
      .mini-card { flex:0 0 70%; border:1px solid var(--line); border-radius:12px; padding:12px; background:#fff; }
      .hscroll .card { flex:0 0 80%; }
      .reco-top .subhead{ color: #fff;}
      .mini-desc { display:block; margin-top:4px; min-height:56px; } /* ~4 lines at ~14px */
      .buy-desc { display:block; margin-top:4px; min-height:70px; } /* ~5 lines at ~14px */
      .chip-white { background:#ffffff; border-color:var(--line); }
      .suggest-two { display:block; min-height:28px; } /* ~2 lines at ~14px */
      /* full plan details */
      .detail-hero { height:140px; border-radius:12px; background:url('./assets/GradientBackground.svg') center/cover no-repeat; margin:12px 0; }
      .pill { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--line); border-radius:999px; font-size:12px; background:#fff; }
      .pill-low { background:#fff7cc; border-color:#facc15; color:#8a6d00; padding:4px 8px; font-size:11px; }
      .pill-med { background:#ffe8d6; border-color:#fb923c; color:#9a3412; padding:4px 8px; font-size:11px; }
      .pill-high { background:#eafff0; border-color:#9feab9; color:#1a7f3c; padding:4px 8px; font-size:11px; }
      /* Risk indicator pills for dashboard personas */
      .risk-high { background:#fde8e8; border-color:#fecaca; color:#b91c1c; }
      .risk-med { background:#fff7ed; border-color:#fed7aa; color:#b45309; }
      .risk-low { background:#ecfdf5; border-color:#a7f3d0; color:#065f46; }
      /* Prevent pills from stretching in flex rows */
      .row > .pill { flex:0 0 auto; }
      /* Small status badges over icons */
      .badge-dot { position:absolute; top:-4px; right:-4px; width:14px; height:14px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:10px; line-height:1; border:2px solid #fff; color:#fff; }
      .badge-green { background:#22c55e; }
      .badge-yellow { background:#facc15; color:#111827; }
      .badge-orange { background:#f97316; }
      .badge-red { background:#dc2626; }
      .grid-two { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
      /* compare table */
      .cmp-table { width:100%; border-collapse:separate; border-spacing:0; }
      .cmp-scroll { overflow-x:auto; }
      .cmp-row { display:grid; grid-template-columns:140px repeat(4,160px); align-items:center; padding:8px 10px; min-width:780px; font-size:14px; }
      .cmp-row + .cmp-row { border-top:1px solid var(--line); }
      .cmp-head { font-weight:700; color:var(--ink); }
      .cmp-feat { display:flex; align-items:center; gap:8px; color:#30456a; font-weight:700; }
      .cmp-val { text-align:center; color:#0b1324; font-weight:600; }
      .cmp-subtle { color:#51607f; font-weight:500; }
      .cmp-yes { color:#1a7f3c; font-weight:700; }
      .cmp-no { color:#c2410c; font-weight:700; }
      /* prevent vertical scroll inside compare drawer */
      .drawer { overflow-y:hidden; }
      /* toggle switch */
      .toggle { position:relative; display:inline-block; width:38px; height:22px; }
      .toggle input { opacity:0; width:0; height:0; }
      .toggle-slider {
        position:absolute; inset:0; cursor:pointer; border-radius:999px;
        background:#e6edf7; border:1px solid var(--line); transition:background .2s, border-color .2s;
      }
      .toggle-slider::before {
        content:""; position:absolute; width:16px; height:16px; left:3px; top:50%;
        transform:translateY(-50%); border-radius:50%; background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.2);
        transition:transform .2s;
      }
      .toggle input:checked + .toggle-slider { background:#2b7fff; border-color:#1e5fd1; }
      .toggle input:checked + .toggle-slider::before { transform:translate(16px,-50%); }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="phone" role="application" aria-label="Telecom B2C mobile prototype">
        <!-- Welcome (First Step) -->
        <section id="screen-welcome" class="screen active" aria-labelledby="welcome-title">
          <div class="welcome-top">
            <div class="dots" aria-hidden="true"><span class="dot active"></span><span class="dot"></span><span class="dot"></span></div>
            <div class="hero" aria-hidden="true"><img src="./assets/Welcome-icon.svg" alt="Welcome" style="width:100%; height:100%; object-fit:contain; border-radius:50%;" /></div>
            <header id="welcome-title" class="center" style="font-size:28px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0; margin-bottom:20px;">Welcome!<br/>Let’s build the perfect bundle for you</header>
            <p class="muted center" style="margin:4px 20px 24px; line-height:1.4; font-size:18px;">
              Tell us what matters most to you and we’ll design your ideal bundle together
            </p>
          </div>
          <div class="content" style="padding-top:36px;">
            <!-- Section 1: Top Priority Need -->
            <div>
              <div class="toolbar" id="priorityGroup1" role="group" aria-label="Top priority need" style="justify-content:center; margin-top:5px; margin-bottom:30px;">
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Switch provider')">Switch provider</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Add device')">Add device</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Lower monthly cost')">Lower monthly cost</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Get faster internet')">Get faster internet</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Fix current issue')">Fix current issue</span>
              </div>
              <!-- divider removed before How this Works -->
            </div>
            <!-- (moved Abandoned Cart section to Explore Offers) -->

            <div style="margin-top:12px; padding-top:1em; padding-bottom:1em; background:#5a5bc6; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <div class="section-title center" style="font-weight:700; font-size:18px; color:#26074f;">How this Works?</div>
              <p class="center" style="margin:6px 20px 8px; color:#26074f; line-height:1.4; font-size:14px; font-weight:500;">• Tell us your needs • Get AI-curated options • Customise and confirm</p>
              <p class="muted center" style="margin:0 20px 1em; color:#D2ABFF; line-height:1.4; font-size:12px;">You’re always in control - we only personalise with your consent</p>
              </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch; border-top:none;">
            <button id="welcomeCta" class="cta cta-lg btn-disabled" style="flex:0 0 auto" onclick="welcomeFindPlans()">Start co-design</button>
          </div>
          <!-- Footer removed from welcome screen -->
        </section>
        <!-- Compare Products -->
        <section id="screen-compare" class="screen" aria-labelledby="compare-title" style="background:#eef6ff;">
          <header id="compare-title" style="font-weight:700; padding:12px 20px 8px; color:var(--ink); display:flex; align-items:center; justify-content:center; position:relative; background:#eef6ff;">
            <span role="button" tabindex="0" onclick="goto('screen-results-reco')" style="position:absolute; left:20px; cursor:pointer;">←</span>
            <span>Compare Products</span>
          </header>
          <div class="content" style="padding-top:12px;">
            <div class="toolbar" id="compareTabs" style="justify-content:flex-start; gap:8px; overflow-x:auto; margin-top:5em;">
              <span id="tab-s24" class="chip chip-toggle selected" onclick="compareTab('s24')">Samsung Galaxy S24 FE</span>
              <span id="tab-iphone" class="chip chip-toggle" onclick="compareTab('iphone')">iPhone 17 Pro Max</span>
              <span id="tab-pixel" class="chip chip-toggle" onclick="compareTab('pixel')">Google Pixel 8a</span>
            </div>
            <div id="compareScroller" class="hscroll" style="gap:12px; padding-top:10px;">
              <!-- Card: S24 -->
              <article id="cmp-s24" class="card" style="flex:0 0 85%; background:#fff; margin:40px 0;">
                <div class="plan" style="font-size:20px;">Samsung Galaxy S24 FE</div>
                <span class="elig" style="display:inline-block; margin-top:6px;">Best Performance</span>
                <img src="./assets/SamsungGalaxyS24FE.svg" alt="Samsung Galaxy S24 FE" style="width:100%; height:160px; object-fit:contain; background:#fff; border-radius:10px; margin-top:10px;"/>
                <div class="price" style="font-size:18px;">Total Upfront Cost: <strong>$199</strong></div>
                <div class="divider" style="margin:8px 0;"></div>
                <div style="font-size:17px;">Monthly Cost: <strong>$55/mo</strong></div>
                <div class="divider" style="margin:8px 0;"></div>
                <div style="font-size:17px;">Contract Length: <strong>24 months</strong></div>
                <div class="divider" style="margin:8px 0;"></div>
                <div style="font-size:17px; margin-bottom:14px;">Total Cost: <strong>$1519</strong></div>
                <div style="margin-top:8px; color:#1a7f3c; font-size:16px; line-height:1.5;">
                  <div>Lowest Net Monthly Payment</div>
                  <div style="margin-top:6px;">Reliable Performance for Value</div>
                </div>
              </article>
              <!-- Card: iPhone -->
              <article id="cmp-iphone" class="card" style="flex:0 0 85%; background:#fff; margin:40px 0;">
                <div class="plan" style="font-size:20px;">iPhone 17 Pro Max</div>
                <span class="elig" style="display:inline-block; margin-top:6px;">Best Up‑front</span>
                <img src="./assets/iPhone17ProMax.svg" alt="iPhone 17 Pro Max" style="width:100%; height:160px; object-fit:contain; background:#fff; border-radius:10px; margin-top:10px;"/>
                <div class="price" style="font-size:18px;">Total Upfront Cost: <strong>$399</strong></div>
                <div class="divider" style="margin:8px 0;"></div>
                <div style="font-size:17px;">Monthly Cost: <strong>$115/mo</strong></div>
                <div class="divider" style="margin:8px 0;"></div>
                <div style="font-size:17px;">Contract Length: <strong>24 months</strong></div>
                <div class="divider" style="margin:8px 0;"></div>
                <div style="font-size:17px; margin-bottom:14px;">Total Cost: <strong>$3159</strong></div>
                <div style="margin-top:8px; color:#1a7f3c; font-size:16px; line-height:1.5;">
                  <div>Maximized Future Value</div>
                  <div style="margin-top:6px;">Unthrottled Performance Access</div>
                </div>
              </article>
              <!-- Card: Pixel -->
              <article id="cmp-pixel" class="card" style="flex:0 0 85%; background:#fff; margin:40px 0;">
                <div class="plan" style="font-size:20px;">Google Pixel 8a</div>
                <span class="elig" style="display:inline-block; margin-top:6px;">Low Upfront Cost</span>
                <img src="./assets/GooglePixel8a.svg" alt="Google Pixel 8a" style="width:100%; height:160px; object-fit:contain; background:#fff; border-radius:10px; margin-top:10px;"/>
                <div class="price" style="font-size:18px;">Total Upfront Cost: <strong>$0</strong></div>
                <div class="divider" style="margin:8px 0;"></div>
                <div style="font-size:17px;">Monthly Cost: <strong>$79/mo</strong></div>
                <div class="divider" style="margin:8px 0;"></div>
                <div style="font-size:17px;">Contract Length: <strong>24 months</strong></div>
                <div class="divider" style="margin:8px 0;"></div>
                <div style="font-size:17px; margin-bottom:14px;">Total Cost: <strong>$1896</strong></div>
                <div style="margin-top:8px; color:#1a7f3c; font-size:16px; line-height:1.5;">
                  <div>True Zero Down Payment</div>
                  <div style="margin-top:6px;">Maximum Financial Flexibility</div>
                </div>
              </article>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:center; background:#ffffff; margin-left:-20px; margin-right:-20px; padding:10px 20px 14px;">
            <button class="cta" style="width:80%;" onclick="handleComparePick()">Pick &amp; Co‑design</button>
            <div class="center"><span class="link" role="button" tabindex="0" onclick="handleCompareDetails()">See Full Details</span></div>
          </div>
        </section>
        <!-- Consent Modal removed -->
        <!-- AI Optimisation Loading -->
        <section id="screen-ai" class="screen" aria-labelledby="ai-title" style="background:url('./assets/GradientBackground.svg') center/cover no-repeat;">
          <header id="ai-title" style="font-weight:700; padding:8px 20px 0; color:var(--ink); display:flex; align-items:center; justify-content:center; position:relative; background:transparent;">
            <span></span>
          </header>
          <div class="content" style="padding-top:0; display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:calc(100vh - 80px);">
            <div class="dots" aria-hidden="true"><span class="dot"></span><span class="dot"></span><span class="dot active"></span></div>
            <span aria-hidden="true" style="display:inline-flex; margin-bottom:12px;">
              <img src="./assets/sparkle-icon.svg" alt="" width="36" height="36"/>
            </span>
            <div class="progress" aria-hidden="true" style="margin-bottom:12px;">
              <div id="aiFill" class="progress-fill"></div>
          </div>
            <div class="center plan" style="font-size:22px; margin:12px 0;">AI is Optimising…</div>
          </div>
        </section>
        <!-- Basics (Second Step) -->
        <section id="screen-basics" class="screen" aria-labelledby="basics-title">
          <div class="welcome-top">
            <div class="dots" aria-hidden="true"><span class="dot"></span><span class="dot active"></span><span class="dot"></span></div>
            <div class="hero" aria-hidden="true"><img src="./assets/Welcome-icon.svg" alt="Welcome" style="width:100%; height:100%; object-fit:contain; border-radius:50%;" /></div>
            <header id="basics-title" class="center" style="font-size:28px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0;">Tell us the basics!</header>
            <p class="muted center" style="margin:4px 20px 24px; line-height:1.4; font-size:16px;">
              Share a few quick details or import your current bill so we can match you with the most accurate, money-saving bundle
            </p>
          </div>
          <div class="content" style="padding-top:16px;">
            <!-- Ask AI user Analysis -->
            <button id="basicsAiBtn" class="cta-secondary" style="width:100%; margin-bottom:12px;" onclick="basicsAskAiAnalysis()">
              <span aria-hidden="true" style="display:inline-flex; align-items:center; justify-content:center; margin-right:6px;">
                <img src="./assets/sparkle-icon.svg" alt="" width="18" height="18"/>
              </span>
              Ask AI user Analysis
            </button>
            <!-- Top Priorities -->
            <div>
              <div class="section-title">Top Priorities<span class="req" aria-hidden="true">*</span></div>
              <div class="section-sub">Select Priority in order of importance</div>
              <div class="toolbar" id="basicsPriorityGroup" role="group" aria-label="Top priorities">
                <span class="chip chip-toggle" onclick="toggleBasicsPriority(this,'Cost')">Cost</span>
                <span class="chip chip-toggle" onclick="toggleBasicsPriority(this,'Performance')">Performance</span>
                <span class="chip chip-toggle" onclick="toggleBasicsPriority(this,'Device')">Device</span>
                <span class="chip chip-toggle" onclick="toggleBasicsPriority(this,'Flexible Contract')">Flexible Contract</span>
                <span class="chip chip-toggle" onclick="toggleBasicsPriority(this,'Low EMI')">Low EMI</span>
              </div>
              <div class="divider"></div>
            </div>
            <!-- Monthly Data (GB) -->
            <div>
              <div class="section-title" style="display:flex; align-items:center; justify-content:space-between;">
                <span>Monthly Data (GB)<span class="req" aria-hidden="true">*</span></span>
                <span id="basicsDataVal" class="plan" style="font-weight:700;">0 GB</span>
            </div>
              <input id="basicsData" class="styled-range" type="range" min="0" max="100" step="1" value="0" oninput="onBasicsRangeInput('basicsData','basicsDataVal',' GB')" />
              <div class="row" style="justify-content:space-between; margin-top:4px;">
                <span class="muted">0GB</span>
                <span class="muted">100GB</span>
          </div>
              <div class="divider"></div>
            </div>
            <!-- Streaming (hrs/month) -->
            <div>
              <div class="section-title" style="display:flex; align-items:center; justify-content:space-between;">
                <span>Streaming (hrs/month)<span class="req" aria-hidden="true">*</span></span>
                <span id="basicsStreamVal" class="plan" style="font-weight:700;">0 hrs</span>
          </div>
              <input id="basicsStream" class="styled-range" type="range" min="0" max="300" step="5" value="0" oninput="onBasicsRangeInput('basicsStream','basicsStreamVal',' hrs')" />
              <div class="row" style="justify-content:space-between; margin-top:4px;">
                <span class="muted">0hrs</span>
                <span class="muted">300hrs</span>
              </div>
              <div class="divider"></div>
            </div>
            <!-- Monthly Budget -->
            <div>
              <div class="section-title" style="display:flex; align-items:center; justify-content:space-between;">
                <span>Monthly Budget<span class="req" aria-hidden="true">*</span></span>
                <span id="basicsBudgetVal" class="plan" style="font-weight:700;">$50</span>
              </div>
              <input id="basicsBudget" class="styled-range" type="range" min="50" max="450" step="5" value="50" oninput="onBasicsRangeInput('basicsBudget','basicsBudgetVal', '', '$')" />
              <div class="row" style="justify-content:space-between; margin-top:4px;">
                <span class="muted">$50</span>
                <span class="muted">$450</span>
              </div>
              <div class="divider"></div>
            </div>
            <!-- Current Plan -->
            <div>
              <div class="section-title">Describe Current Plan <span class="muted">(optional)</span></div>
              <input id="basicsPlanDesc" type="text" placeholder="Eg., • Provider X • 500mbps • $70/mo" style="margin-top:10px;" />
              <div class="row" style="margin-top:12px;">
                <button class="cta-secondary" style="flex:1; width:100%;" onclick="importBill()">Upload bill</button>
              </div>
              <div class="divider"></div>
            </div>
            <!-- Checkboxes -->
            <div style="display:flex; flex-direction:column; gap:10px; align-items:flex-start;">
              <label style="display:flex; align-items:center; gap:8px;">
                <input id="basicsFinance" type="checkbox" />
                <span style="font-size:14px; color:var(--ink);">Include Device Financing</span>
              </label>
              <label style="display:flex; align-items:center; gap:8px;">
                <input id="basicsPort" type="checkbox" />
                <span style="font-size:14px; color:var(--ink);">Port Number</span>
              </label>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="basicsCta" class="cta cta-lg btn-disabled" style="flex:0 0 auto; width:100%;" onclick="basicsContinue()">Continue</button>
            <button class="cta-secondary" style="flex:0 0 auto; width:100%;" onclick="basicsBack()">Back</button>
          </div>
        </section>
              <!-- Review Your Plan -->
        <section id="screen-review" class="screen" aria-labelledby="review-title">
          <header id="review-title" style="font-weight:700; padding:12px 20px 8px; color:var(--ink); display:flex; align-items:center; justify-content:center; position:relative; background:#eef6ff;">
            <span role="button" tabindex="0" onclick="historyBackReview()" style="position:absolute; left:20px; cursor:pointer;">←</span>
            <span id="reviewTitleText">Review Your Bundle</span>
          </header>
          <div class="content" style="padding-top:0;">
            <!-- Your Device -->
            <div class="plan" style="margin:10px 0 6px; font-size:16px;">Your Device</div>
            <article class="card" style="display:flex; align-items:center; gap:12px;">
              <div style="flex:1;">
                <div id="rvDeviceName" class="plan" style="font-size:16px;">iPhone 15 Pro</div>
                <div id="rvDeviceSub" class="muted">Natural Titanium, 256GB</div>
                </div>
              <img id="rvDeviceImg" src="./assets/iPhone17ProMax.svg" alt="Device" style="width:68px; height:68px; object-fit:contain; border-radius:8px;"/>
            </article>
            <!-- Your Plan -->
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Your Plan</div>
            <article class="card">
              <div class="row" style="align-items:center;">
                <div id="rvPlanName" class="plan" style="flex:1; font-size:16px;">Unlimited Plus</div>
                <div id="rvPlanPrice" class="price" style="font-size:16px;">$75.00<span class="muted">/mo</span></div>
                </div>
              <div class="muted" style="margin-top:6px;">Unlimited Data, 50GB Hotspot, 4K Streaming</div>
              </article>
            <!-- Add-ons -->
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Add-ons</div>
            <article class="card">
              <div class="row" style="align-items:center; margin-top:0;">
                <div class="muted" style="flex:1;">Device Protection</div>
                <div class="muted">$15.00<span class="muted">/mo</span></div>
            </div>
              <div class="row" style="align-items:center; margin-top:8px;">
                <div class="muted" style="flex:1;">International Calling</div>
                <div class="muted">$10.00<span class="muted">/mo</span></div>
              </div>
            </article>
            <!-- Cost Summary -->
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Cost Summary</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="align-items:center;">
                <div class="plan" style="flex:1;">Due Today</div>
                <div id="rvDueToday" class="price">$58.85</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="align-items:center;">
                <div class="muted" style="flex:1;">Device Down Payment</div>
                <div class="muted">$0.00</div>
                </div>
              <div class="row" style="align-items:center; margin-top:6px;">
                <div class="muted" style="flex:1;">Activation Fee</div>
                <div class="muted">$35.00</div>
              </div>
              <div class="row" style="align-items:center; margin-top:6px;">
                <div class="muted" style="flex:1;">Est. Taxes &amp; Fees</div>
                <div class="muted">$23.85</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div class="row" style="align-items:center;">
                <div class="plan" style="flex:1;">Estimated Monthly Bill</div>
                <div id="rvMonthlyBill" class="price">$141.67</div>
              </div>
              <div class="row" style="align-items:center; margin-top:6px;">
                <div class="muted" style="flex:1;">Unlimited Plus Plan</div>
                <div class="muted">$75.00</div>
              </div>
              <div class="row" style="align-items:center; margin-top:6px;">
                <div class="muted" style="flex:1;">Device Financing</div>
                <div class="muted">$41.67</div>
              </div>
              <div class="row" style="align-items:center; margin-top:6px;">
                <div class="muted" style="flex:1;">Add-ons</div>
                <div class="muted">$25.00</div>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="width:100%;">Confirm &amp; Start Porting</button>
            <button class="cta-secondary" style="width:100%;">Confirm &amp; Schedule Activation</button>
            <div class="center"><span class="link" style="font-size:13px;">Save &amp; Compare Later</span></div>
          </div>
        </section>
        <!-- Checkout / Payment -->
        <section id="screen-checkout" class="screen" aria-labelledby="checkout-title">
          <header id="checkout-title" style="font-weight:700; padding:12px 20px 8px; color:var(--ink); display:flex; align-items:center; justify-content:center; position:relative; background:#eef6ff;">
            <span role="button" tabindex="0" onclick="goto('screen-review')" style="position:absolute; left:20px; cursor:pointer;">←</span>
            <span>Checkout</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <div class="plan" style="margin:8px 0 6px; font-size:16px;">Order Summary</div>
              <article class="card" style="background:#fff;">
                <div class="row" style="align-items:center;">
                  <div class="muted" id="coPlanName" style="flex:1;">Plan</div>
                  <div class="plan" id="coPlanPrice">$0.00<span class="muted">/mo</span></div>
                </div>
                <div class="row" style="align-items:center; margin-top:10px;">
                  <div class="muted" style="flex:1;">One‑time Installation Fee</div>
                  <div class="plan" id="coInstall">$0.00</div>
                </div>
                <div class="row" style="align-items:center; margin-top:10px;">
                  <div class="muted" style="flex:1;">Taxes &amp; Surcharges</div>
                  <div class="plan" id="coTaxes">$0.00</div>
                </div>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="row" style="align-items:center;">
                  <div class="plan" style="flex:1;">Total Due Today</div>
                  <div class="plan" id="coDueToday">$0.00</div>
                </div>
              </article>
            </div>
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Payment Method</div>
            <div class="row" role="tablist" aria-label="Payment method" style="gap:10px;">
              <button id="tabCard" class="cta-secondary" role="tab" aria-selected="true" style="flex:1; font-weight:700;">Credit/Debit Card</button>
              <button id="tabPayPal" class="cta-secondary" role="tab" aria-selected="false" style="flex:1; opacity:.6; pointer-events:none;">PayPal</button>
            </div>
            <article class="card" style="margin-top:10px;">
              <label class="subtle" for="coCardNum" style="display:block;">Card Number</label>
              <input id="coCardNum" type="text" inputmode="numeric" placeholder="0000 0000 0000 0000" />
              <div class="row" style="margin-top:8px;">
                <div>
                  <label class="subtle" for="coExp">Expiry Date</label>
                  <input id="coExp" type="text" placeholder="MM/YY" />
                </div>
                <div>
                  <label class="subtle" for="coCvc">CVC</label>
                  <input id="coCvc" type="text" placeholder="123" />
                </div>
              </div>
              <div style="margin-top:8px;">
                <label class="subtle" for="coName" style="display:block;">Name on Card</label>
                <input id="coName" type="text" placeholder="John Doe" />
              </div>
              <div style="margin-top:8px;">
                <label style="display:flex; align-items:center; gap:8px;">
                  <input id="coSave" type="checkbox" /> <span class="muted">Save card for future payments</span>
                </label>
              </div>
              <div class="card" style="background:#eaf1ff; border-color:#cfe0ff; margin-top:10px;">
                <span class="muted" style="font-weight:600;">Secure SSL Encryption</span>
              </div>
              <div style="margin-top:10px;">
                <label style="display:flex; align-items:center; gap:8px;">
                  <input id="coAgree" type="checkbox" /> <span class="muted">I agree to the <span class="link">Terms &amp; Conditions</span> and <span class="link">Privacy Policy</span>.</span>
                </label>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="coPayBtn" class="cta" style="flex:0 0 auto" onclick="openSuccess()">Pay &amp; Activate Plan</button>
          </div>
        </section>
        <!-- Checkout / Payment (Upgrade) -->
        <section id="screen-checkout-upgrade" class="screen" aria-labelledby="checkout-title-upgrade">
          <header id="checkout-title-upgrade" style="font-weight:700; padding:12px 20px 8px; color:var(--ink); display:flex; align-items:center; justify-content:center; position:relative; background:#eef6ff;">
            <span role="button" tabindex="0" onclick="goto('screen-review')" style="position:absolute; left:20px; cursor:pointer;">←</span>
            <span>Checkout Upgrade Plan</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <div class="plan" style="margin:8px 0 6px; font-size:16px;">Order Summary</div>
              <article class="card" style="background:#fff;">
                <div class="row" style="align-items:center;">
                  <div class="muted" id="coPlanNameUp" style="flex:1;">Plan</div>
                  <div class="plan" id="coPlanPriceUp">$0.00<span class="muted">/mo</span></div>
                </div>
                <div class="row" style="align-items:center; margin-top:10px;">
                  <div class="muted" style="flex:1;">One‑time Installation Fee</div>
                  <div class="plan" id="coInstallUp">$0.00</div>
                </div>
                <div class="row" style="align-items:center; margin-top:10px;">
                  <div class="muted" style="flex:1;">Taxes &amp; Surcharges</div>
                  <div class="plan" id="coTaxesUp">$0.00</div>
                </div>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="row" style="align-items:center;">
                  <div class="plan" style="flex:1;">Total Due Today</div>
                  <div class="plan" id="coDueTodayUp">$0.00</div>
                </div>
              </article>
            </div>
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Payment Method</div>
            <div class="row" role="tablist" aria-label="Payment method" style="gap:10px;">
              <button class="cta-secondary" role="tab" aria-selected="true" style="flex:1; font-weight:700;">Credit/Debit Card</button>
              <button class="cta-secondary" role="tab" aria-selected="false" style="flex:1; opacity:.6; pointer-events:none;">PayPal</button>
            </div>
            <article class="card" style="margin-top:10px;">
              <label class="subtle" style="display:block;">Card Number</label>
              <input type="text" inputmode="numeric" placeholder="0000 0000 0000 0000" />
              <div class="row" style="margin-top:8px;">
                <div>
                  <label class="subtle" style="display:block;">Expiry Date</label>
                  <input type="text" placeholder="MM/YY" />
                </div>
                <div>
                  <label class="subtle" style="display:block;">CVC</label>
                  <input type="text" placeholder="123" />
                </div>
              </div>
              <div style="margin-top:8px;">
                <label class="subtle" style="display:block;">Name on Card</label>
                <input type="text" placeholder="John Doe" />
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="coPayBtnUp" class="cta" style="flex:0 0 auto" onclick="openSuccess()">Pay &amp; Upgrade Plan</button>
          </div>
        </section>
        <!-- Success / You're All Set -->
        <section id="screen-success" class="screen" aria-labelledby="success-title">
          <div class="address-top" style="padding-top:10px; padding-bottom:8px; min-height:34vh; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <div style="width:72px; height:72px; border-radius:36px; background:#eafff0; border:2px solid #9feab9; margin:8px auto; display:flex; align-items:center; justify-content:center; color:#1a7f3c; font-size:30px;">✓</div>
            <h1 id="success-title" class="display-h1" style="font-size:24px; font-weight:800; line-height:1.25; margin:0; padding-bottom:2px; text-align:center;">You're All Set!</h1>
            <p class="subhead" id="success-sub" style="margin:6px 16px 10px; line-height:1.4; font-size:14px; text-align:center;">Your plan is active! Welcome aboard.</p>
          </div>
          <div class="content" style="padding-top:8px;">
            <div class="plan" style="margin:8px 0 6px; font-size:16px;">Plan Details</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Plan:</div>
                <div class="plan" id="suPlan">—</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Speed:</div>
                <div class="plan" id="suSpeed">—</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Activation Date:</div>
                <div class="plan" id="suActivation">—</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">First Bill Date:</div>
                <div class="plan" id="suFirstBill">—</div>
              </div>
            </article>
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Feedback</div>
            <article class="card" style="margin-top:6px; padding:12px;">
              <div class="plan" style="font-size:16px; text-align:center; margin:0 0 6px;">How was your activation experience?</div>
              <div id="suStars" class="center" role="group" aria-label="Rate your activation experience"
                   style="font-size:22px; letter-spacing:4px; color:#f59e0b; margin:2px 0 8px;">
                <span class="star" role="button" tabindex="0" aria-label="1 star"
                      style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRating(1)"
                      onkeydown="if(event.key==='Enter'||event.key===' '){setStarRating(1);event.preventDefault();}">☆</span>
                <span class="star" role="button" tabindex="0" aria-label="2 stars"
                      style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRating(2)"
                      onkeydown="if(event.key==='Enter'||event.key===' '){setStarRating(2);event.preventDefault();}">☆</span>
                <span class="star" role="button" tabindex="0" aria-label="3 stars"
                      style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRating(3)"
                      onkeydown="if(event.key==='Enter'||event.key===' '){setStarRating(3);event.preventDefault();}">☆</span>
                <span class="star" role="button" tabindex="0" aria-label="4 stars"
                      style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRating(4)"
                      onkeydown="if(event.key==='Enter'||event.key===' '){setStarRating(4);event.preventDefault();}">☆</span>
                <span class="star" role="button" tabindex="0" aria-label="5 stars"
                      style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRating(5)"
                      onkeydown="if(event.key==='Enter'||event.key===' '){setStarRating(5);event.preventDefault();}">☆</span>
              </div>
              <textarea rows="4" placeholder="Tell us more (optional)…" style="width:100%; margin-top:6px;"></textarea>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="flex:0 0 auto" onclick="goto('screen-entry')">Submit Feedback</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-dashboard')">Go to Dashboard</span></div>
          </div>
        </section>
        <!-- Success / Upgrade Outcome -->
        <section id="screen-success-upgrade" class="screen" aria-labelledby="success-title-up">
          <div class="address-top" style="padding-top:10px; padding-bottom:8px; min-height:34vh; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <div style="width:72px; height:72px; border-radius:36px; background:#eafff0; border:2px solid #9feab9; margin:8px auto; display:flex; align-items:center; justify-content:center; color:#1a7f3c; font-size:30px;">✓</div>
            <h1 id="success-title-up" class="display-h1" style="font-size:24px; font-weight:800; line-height:1.25; margin:0; padding-bottom:2px; text-align:center;">Congratulations!</h1>
            <p class="subhead" id="success-sub-up" style="margin:6px 16px 10px; line-height:1.4; font-size:14px; text-align:center;">We've processed your upgrade request. You'll see the change reflected on your next bill.</p>
          </div>
          <div class="content" style="padding-top:8px;">
            <div class="plan" style="margin:8px 0 6px; font-size:16px;">Plan Details</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Previous Plan</div>
                <div class="plan" id="suUpPrev">—</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">New Plan</div>
                <div class="plan" id="suUpNew">—</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Effective Date</div>
                <div class="plan" id="suUpEffective">—</div>
              </div>
            </article>
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Feedback</div>
            <article class="card" style="margin-top:6px; padding:12px;">
              <div class="plan" style="font-size:16px; text-align:center; margin:0 0 6px;">Was this recommendation helpful?</div>
              <div id="suUpStars" class="center" role="group" aria-label="Rate recommendation" style="font-size:22px; letter-spacing:4px; color:#f59e0b; margin:2px 0 6px;">
                <span class="star" role="button" tabindex="0" aria-label="1 star" style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRatingUp(1)" onkeydown="if(event.key==='Enter'||event.key===' '){setStarRatingUp(1);event.preventDefault();}">☆</span>
                <span class="star" role="button" tabindex="0" aria-label="2 stars" style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRatingUp(2)" onkeydown="if(event.key==='Enter'||event.key===' '){setStarRatingUp(2);event.preventDefault();}">☆</span>
                <span class="star" role="button" tabindex="0" aria-label="3 stars" style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRatingUp(3)" onkeydown="if(event.key==='Enter'||event.key===' '){setStarRatingUp(3);event.preventDefault();}">☆</span>
                <span class="star" role="button" tabindex="0" aria-label="4 stars" style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRatingUp(4)" onkeydown="if(event.key==='Enter'||event.key===' '){setStarRatingUp(4);event.preventDefault();}">☆</span>
                <span class="star" role="button" tabindex="0" aria-label="5 stars" style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRatingUp(5)" onkeydown="if(event.key==='Enter'||event.key===' '){setStarRatingUp(5);event.preventDefault();}">☆</span>
              </div>
              <div class="divider" style="margin:6px 0;"></div>
              <div class="plan" style="font-size:14px; margin:4px 0 4px;">Tell us more (optional)</div>
              <div class="toolbar" id="upFeedbackChips" style="gap:8px; flex-wrap:wrap;">
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Easy to understand</span>
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Good Value</span>
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Perfect Fit</span>
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Not Relevant</span>
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Too Expensive</span>
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Confusing</span>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="flex:0 0 auto" onclick="goto('screen-dashboard')">Submit Feedback &amp; Go to Dashboard</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-dashboard')">Need Help? Contact Support</span></div>
          </div>
        </section>

        <!-- Co-Design -->
        <section id="screen-codesign" class="screen" aria-labelledby="codesign-title">
          <div class="reco-top" style="padding-top:4em; position:relative;">
            <span role="button" tabindex="0" onclick="goto('screen-results-reco')" style="position:absolute; top:8px; left:20px; cursor:pointer;">←</span>
            <header id="codesign-title" class="center" style="font-size:28px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0; margin-top:40px; margin-bottom:20px; font-weight:800px;">Let’s Fine‑Tune Your Bundle Together!</header>
            <p class="subhead" style="margin:4px 20px 12px; line-height:1.4; margin-bottom:30px; font-size:18px;">Swap devices, adjust financing, or tweak plan features - every change updates your pricing and eligibility instantly</p>
          </div>
          <div class="content" style="padding-top:0;">
            <div id="cdDeviceRow" class="hscroll" style="gap:10px; padding-bottom:6px;">
              <!-- Samsung Galaxy S24 FE -->
              <article id="card-s24" class="card" style="flex:0 0 75%; background:#fff; cursor:pointer; position:relative;" onclick="selectCdDeviceCard('Samsung Galaxy S24 FE')" role="button" tabindex="0" onkeydown="if(event.key==='Enter'){selectCdDeviceCard('Samsung Galaxy S24 FE')}">
                <span class="elig" style="display:inline-block; margin-bottom:6px;">Best for Monthly Savings</span>
                <div style="position:relative;">
                  <img src="./assets/SamsungGalaxyS24FE.svg" alt="Samsung Galaxy S24 FE" style="width:100%; height:220px; object-fit:contain; background:#fff; border-radius:10px; padding:8px;" />
                </div>
              <span id="sel-s24" style="position:absolute; top:3px; right:3px; width:28px; height:28px; border-radius:14px; background:var(--primary); color:#fff; display:none; align-items:center; justify-content:center; font-weight:700; box-shadow:0 1px 2px rgba(0,0,0,.2);">✓</span>
                <div class="plan" style="font-size:16px; margin-top:8px;">Samsung Galaxy S24 FE</div>
                <div class="muted">128GB, Blue Titanium</div>
                <div class="muted" style="margin-top:6px;">Upfront Cost: $199.00</div>
                <div class="muted">Monthly Price: $55.00/mo</div>
                <button id="btn-s24" class="cta-secondary" style="width:100%; margin-top:8px;" onclick="selectCdDeviceCard('Samsung Galaxy S24 FE')">Select</button>
              </article>
              <!-- iPhone 17 Pro Max -->
              <article id="card-iphone" class="card" style="flex:0 0 75%; background:#fff; cursor:pointer; position:relative;" onclick="selectCdDeviceCard('iPhone 17 Pro Max')" role="button" tabindex="0" onkeydown="if(event.key==='Enter'){selectCdDeviceCard('iPhone 17 Pro Max')}">
                <span class="elig" style="display:inline-block; margin-bottom:6px;">Best Performance</span>
                <div style="position:relative;">
                  <img src="./assets/iPhone17ProMax.svg" alt="iPhone 17 Pro Max" style="width:100%; height:220px; object-fit:contain; background:#fff; border-radius:10px; padding:8px;" />
                </div>
                <span id="sel-iphone" style="position:absolute; top:3px; right:3px; width:28px; height:28px; border-radius:14px; background:var(--primary); color:#fff; display:none; align-items:center; justify-content:center; font-weight:700; box-shadow:0 1px 2px rgba(0,0,0,.2);">✓</span>
                <div class="plan" style="font-size:16px; margin-top:8px;">iPhone 17 Pro Max</div>
                <div class="muted">256GB, Natural Titanium</div>
                <div class="muted" style="margin-top:6px;">Upfront Cost: $399.00</div>
                <div class="muted">Monthly Price: $115.00/mo</div>
                <button id="btn-iphone" class="cta-secondary" style="width:100%; margin-top:8px;" onclick="selectCdDeviceCard('iPhone 17 Pro Max')">Select</button>
              </article>
              <!-- Google Pixel 8a -->
              <article id="card-pixel" class="card" style="flex:0 0 75%; background:#fff; cursor:pointer; position:relative;" onclick="selectCdDeviceCard('Google Pixel 8a')" role="button" tabindex="0" onkeydown="if(event.key==='Enter'){selectCdDeviceCard('Google Pixel 8a')}">
                <span class="elig" style="display:inline-block; margin-bottom:6px;">Low Upfront Cost</span>
                <div style="position:relative;">
                  <img src="./assets/GooglePixel8a.svg" alt="Google Pixel 8a" style="width:100%; height:220px; object-fit:contain; background:#fff; border-radius:10px; padding:8px;" />
                </div>
                <span id="sel-pixel" style="position:absolute; top:3px; right:3px; width:28px; height:28px; border-radius:14px; background:var(--primary); color:#fff; display:none; align-items:center; justify-content:center; font-weight:700; box-shadow:0 1px 2px rgba(0,0,0,.2);">✓</span>
                <div class="plan" style="font-size:16px; margin-top:8px;">Google Pixel 8a</div>
                <div class="muted">128GB, Charcoal</div>
                <div class="muted" style="margin-top:6px;">Upfront Cost: $0.00</div>
                <div class="muted">Monthly Price: $79.00/mo</div>
                <button id="btn-pixel" class="cta-secondary" style="width:100%; margin-top:8px;" onclick="selectCdDeviceCard('Google Pixel 8a')">Select</button>
              </article>
            </div>
          </div>
            <!-- Details sections for selected product -->
            <div class="plan" style="font-size:16px; margin:12px 0 6px; margin-left:20px;">Plan</div>
            <article class="card" aria-label="Plan section" style="background:#fff; width:80%; margin:0 auto; margin-bottom:20px;">
              <div class="row" style="align-items:center; justify-content:flex-start;">
                <div class="plan" style="font-size:14px;">Data Usage</div>
              </div>
              <div class="range-wrap" style="margin-top:6px; position:relative;">
                <span id="cdDataValue" class="plan" style="position:absolute; right:0; top:-18px; font-size:14px;">50 GB</span>
                <input id="cdDataRange" type="range" min="0" max="200" step="5" value="50" class="styled-range" oninput="onBasicsRangeInput('cdDataRange','cdDataValue',' GB')" aria-label="Data usage"/>
                <div class="row" style="justify-content:space-between; margin-top:2px;">
                  <span class="muted">0GB</span>
                  <span class="muted">200GB</span>
                </div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div class="plan" style="font-size:14px; margin-bottom:6px; margin-left:20px">Upgrade to premium</div>
              <div id="cdPremium" class="toolbar" style="flex-wrap:wrap;">
                <span class="chip chip-toggle selected" onclick="cdSingleSelect('cdPremium', this)">Upgrade to Unlimited 5G+</span>
                <span class="chip chip-toggle" onclick="cdSingleSelect('cdPremium', this)">Premium 100GB</span>
                <span class="chip chip-toggle" onclick="cdSingleSelect('cdPremium', this)">Standard 50GB</span>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div class="plan" style="font-size:14px; margin-bottom:6px;">Add Boosters</div>
              <div class="toolbar" style="flex-wrap:wrap;">
                <span class="chip chip-toggle" onclick="cdToggle(this)">Extra Data</span>
                <span class="chip chip-toggle" onclick="cdToggle(this)">Hotspot 10GB</span>
                <span class="chip chip-toggle" onclick="cdToggle(this)">Roaming Day Pass</span>
              </div>
            </article>
            <div class="plan" style="font-size:16px; margin:0 0 6px; margin-left:20px; ">Device Options</div>
            <article class="card" aria-label="Device options" style="background:#fff; width:80%; margin:0 auto; margin-bottom:20px;">
              <label style="display:flex; align-items:center; gap:8px; margin-top:4px;">
                <input id="cdTradeInChk" type="checkbox" /> <span style="font-size:14px; color:var(--ink);">Trade‑In / Sell Device</span>
              </label>
              <label style="display:flex; align-items:center; gap:8px; margin-top:6px;">
                <input id="cdKeepDeviceChk" type="checkbox" /> <span style="font-size:14px; color:var(--ink);">Keep Current Device</span>
              </label>
            </article>
            <div class="plan" style="font-size:16px; margin:0 0 6px; margin-left:20px; ">Add‑ons & Components</div>
            <article class="card" aria-label="Add-ons & Components" style="background:#fff; width:80%; margin:0 auto; margin-bottom:20px;">
              <label style="display:flex; align-items:center; gap:8px; margin-top:4px;">
                <input id="cdProtectChk" type="checkbox" /> <span style="font-size:14px; color:var(--ink);">Add Protection</span>
              </label>
              <label style="display:flex; align-items:center; gap:8px; margin-top:6px;">
                <input id="cdIntlChk" type="checkbox" /> <span style="font-size:14px; color:var(--ink);">International Calling</span>
              </label>
              <label style="display:flex; align-items:center; gap:8px; margin-top:6px;">
                <input id="cdTotalSecChk" type="checkbox" /> <span style="font-size:14px; color:var(--ink);">Total Security Protection</span>
              </label>
              <!-- removed extra Total Security Protection description list -->
            </article>
            <div class="plan" style="font-size:16px; margin:0 0 6px; margin-left:20px; ">Financing Options</div>
            <article class="card" aria-label="Financing options" style="background:#fff; width:80%; margin:0 auto;">
              <div class="plan" style="font-size:14px; margin-bottom:6px;">Installment length</div>
              <div id="cdTenureChips" class="toolbar" style="flex-wrap:wrap;">
                <span class="chip chip-toggle selected" onclick="cdSingleSelect('cdTenureChips', this)">12 months</span>
                <span class="chip chip-toggle" onclick="cdSingleSelect('cdTenureChips', this)">24 months</span>
                <span class="chip chip-toggle" onclick="cdSingleSelect('cdTenureChips', this)">30 months</span>
                <span class="chip chip-toggle" onclick="cdSingleSelect('cdTenureChips', this)">36 months</span>
              </div>
              <label style="display:flex; align-items:center; gap:8px; margin-top:8px;">
                <input id="cdNoDownChk" type="checkbox" /> <span style="font-size:14px; color:var(--ink);">No Down Payment</span>
              </label>
              <label style="display:flex; align-items:center; gap:8px; margin-top:6px;">
                <input id="cdRetailChk" type="checkbox" /> <span style="font-size:14px; color:var(--ink);">Keep retail payment</span>
              </label>
            </article>
            <!-- AI Assistant UI removed -->
            <div class="sticky cd-sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <div class="row" style="align-items:flex-end; justify-content:space-between;">
              <div>
                <div class="muted" style="font-weight:700;">Monthly Estimate</div>
                <div class="price" id="cdMonthlyEstimate" style="font-size:20px;">$0.00<span class="muted">/mo</span></div>
              </div>
              <div style="text-align:right;">
                <div class="muted" style="font-weight:700;">Total Cost Forecast</div>
                <div class="price" id="cdTotalForecast" style="font-size:20px;">$0.00</div>
              </div>
            </div>
            <button class="cta cta-lg" style="width:100%;" onclick="openConsent()">Confirm Bundle</button>
            <button class="cta-secondary" style="width:100%;" onclick="goto('screen-results-reco')">Back to Recommendation</button>
            </div>
          </div>
          <!-- Consent Modal (scoped to this screen) -->
          <div id="consentOverlay" class="overlay hidden" aria-hidden="true" style="z-index:50;"></div>
          <aside id="consentModal" class="drawer hidden" aria-modal="true" role="dialog" aria-labelledby="consentTitle" style="max-height:78%; overflow:auto; left:0; right:0; z-index:60;">
            <header class="center" id="consentTitle" style="font-weight:700;">Consent for Advisor Review</header>
            <div class="content" style="padding-top:0;" >
              <p class="muted center" style="margin:4px 12px 10px;">An Advisor will review your application. Please confirm the required documents and provide consent for a final credit check.</p>
              <div class="divider"></div>
              <div class="plan" style="font-size:16px; margin-bottom:6px;">Consent and verification</div>
              <label style="display:flex; align-items:flex-start; gap:8px; margin-top:8px;">
                <input id="chkStrict" type="checkbox" />
                <div>
                  <div style="font-weight:600; color:var(--ink); font-size:14px;">Stricter Credit Check</div>
                  <div class="muted">I consent for detailed credit check for financing approval.</div>
                </div>
              </label>
              <label style="display:flex; align-items:flex-start; gap:8px; margin-top:10px;">
                <input id="chkAdvisor" type="checkbox" />
                <div>
                  <div style="font-weight:600; color:var(--ink); font-size:14px;">Advisor Call</div>
                  <div class="muted">I am available for a brief verification call if needed.</div>
                </div>
              </label>
            </div>
            <div style="display:flex; flex-direction:column; gap:8px; margin-top:10px;">
              <button id="consentConfirmBtn" class="cta btn-disabled" style="width:100%;" onclick="confirmAdvisorReview()">Confirm Advisor Review</button>
              <button class="cta-secondary" style="width:100%;" onclick="closeConsent()">Close</button>
            </div>
          </aside>
        </section>
        <!-- Special Offer - Detail -->
        <section id="screen-offer-special" class="screen" aria-labelledby="offer-title">
          <header id="offer-title" style="font-weight:700; padding:12px 20px 8px; color:var(--ink); display:flex; align-items:center; justify-content:center; position:relative; background:#eef6ff;">
            <span role="button" tabindex="0" onclick="goto('screen-dashboard')" style="position:absolute; left:20px; cursor:pointer;">←</span>
            <span>Explore Offers</span>
          </header>
          <div class="content">
            <div class="address-top" style="background:#eef6ff; margin-left:-20px; margin-right:-20px; padding:8px 20px 12px;">
            <header class="center" style="font-size:24px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0;">Limited Time Retention Offer for you!</header>
            <article class="card" style="background:#fee2e2; border:1px solid #fca5a5;">
              <div class="row" style="align-items:center; justify-content:space-between; padding-right:10px;">
                <div class="plan" style="font-size:14px; color:#b91c1c; display:flex; align-items:center; gap:8px;">
                  <span style="font-size:16px;">⏱️</span>
                  <span>Offer expires in</span>
                </div>
                <span class="plan" style="background:#ef4444; color:#fff; padding:4px 8px; border-radius:8px; font-size:13px; flex:0 0 auto;">2:15:49</span>
              </div>
            </article>

            <article class="card" role="article" aria-label="Offer summary" style="background:#fff;">
              <div class="row" style="align-items:center; justify-content:space-between; margin-top:6px;">
                <div class="plan" style="font-size:16px; white-space:nowrap;">Upgrade to Unlimited 5G+</div>
              </div>
              <div class="row" style="align-items:center; justify-content:space-between; margin-top:4px;">
                <div class="price" style="font-size:20px;">$65<span class="muted">/mo</span></div>
                <span class="pill pill-high">SAVE $10/mo</span>
              </div>
              <div class="muted" style="margin-top:6px;">Get our best plan ever, just for you.</div>
              <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                <li><strong>Ultra‑Fast 5G+</strong> — Unthrottled Speed</li>
                <li><strong>50 GB Hotspot</strong> — +20 GB from current</li>
              </ul>
              <button class="cta" style="width:100%; margin-top:10px;" onclick="viewPlan('Upgrade to Unlimited 5G+', null, null, '$65.00', 'Unlimited', '', '', '', '', '', 'Ultra‑Fast 5G+ — Unthrottled Speed. 50 GB Hotspot — +20 GB from current', 0, 'High Recommendation', 'pill pill-high'); openReviewUpgrade();">Upgrade Now</button>
              <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1">Chat with us</button>
                <button class="cta-secondary" style="flex:1" onclick="viewPlan('Upgrade to Unlimited 5G+', null, null, '$65.00', 'Unlimited', '', '', '', '', '', 'Ultra‑Fast 5G+ — Unthrottled Speed. 50 GB Hotspot — +20 GB from current', 0, 'High Recommendation', 'pill pill-high', 'screen-plan-offer');">View Plan Details</button>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div class="row" style="align-items:center; gap:10px; cursor:pointer;" onclick="toggleOfferWhy()">
                <span id="offerWhyArrow" class="muted" style="flex:0 0 auto;">▸</span>
                <div class="plan" style="font-size:14px; flex:0 0 auto;">Why you’re seeing this offer</div>
              </div>
              <div id="offerWhyBody" class="hidden">
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li>The system detected that the user's data consumption has recently increased significantly.</li>
                  <li>The offer (Upgrade to Unlimited 5G+) directly solves this problem by providing "Ultra‑Fast 5G+ Unthrottled Speed" and "+20 GB Hotspot".</li>
                  <li>The system recognizes the user is nearing the end of their contract term, putting them in a high‑risk category for churn (switching providers).</li>
                  <li>The offer is positioned as a "LIMITED TIME RETENTION INCENTIVE" and is presented alongside a timer ("Offer expires in 2h 15m").</li>
                </ul>
              </div>
            </article>
            </div>

            <!-- Standalone 'Why you're seeing this offer' and action card were removed (rolled into the product card) -->

            <article class="card">
              <div class="row" style="align-items:center; justify-content:space-between;">
                <div>
                  <div class="plan" style="font-size:14px; margin:0;">Not the right fit?</div>
                  <div class="muted">Explore other options available to you.</div>
                </div>
                <button class="cta-secondary" style="flex:0 0 auto; white-space:nowrap;" onclick="openModifyPlan()">Modify Plan</button>
              </div>
            </article>

            <div class="divider" style="margin:12px 0;"></div>
            <div class="plan" style="margin:12px 0 2px; font-size:16px;">Customers like you also Chose</div>
            <div class="muted" style="margin:0 0 6px;">Showing 4 recommendations in the order of Best Match</div>
            <div class="hscroll" style="gap:10px;">
              <!-- Card 1: Related security add-on -->
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Related security add‑on</div>
                <div class="row" style="align-items:center; gap:8px; margin-top:4px;">
                  <div class="price" style="font-size:16px;">$5<span class="muted">/mo add‑on</span></div>
                  <span class="pill pill-high">High Recommendation</span>
                </div>
                <div class="muted" style="margin-top:6px;">Advanced threat protection and safe browsing for all devices.</div>
                <div class="muted" style="margin-top:6px;"><strong>Focus:</strong> Related security add‑on.</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:6px;">👥 900+ Customers added this bundle for complete peace of mind.</div>
                <button class="cta-secondary" style="width:100%; margin-top:28px;" onclick="viewPlan('Related security add-on', null, null, '$5.00', '', '', '', '', '', '', 'Advanced threat protection and safe browsing for all devices.', 0, 'High Recommendation', 'pill pill-high'); openReviewUpgrade();">Upgrade Now</button>
                <div class="muted" style="margin-top:6px;"><span class="link" role="button" tabindex="0" onclick="viewPlan('Related security add-on', null, null, '$5.00', '', '', '', '', '', '', 'Advanced threat protection and safe browsing for all devices.', 0, 'High Recommendation', 'pill pill-high', 'screen-plan-offer');">View Plan Details</span></div>
              </article>
              <!-- Card 2: Family Unlimited -->
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Family Unlimited</div>
                <div class="row" style="align-items:center; gap:8px; margin-top:4px;">
                  <div class="price" style="font-size:16px;">$45<span class="muted">/line</span></div>
                  <span class="pill pill-med">Medium Recommendation</span>
                </div>
                <div class="muted" style="margin-top:6px;">Unlimited talk, text, and data on 2+ lines.</div>
                <div class="muted" style="margin-top:6px;"><strong>Focus:</strong> Plan is scaled to multiple lines.</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:6px;">👥 1,500+ Customers in your segment chose this plan for its great multi‑line value.</div>
                <button class="cta-secondary" style="width:100%; margin-top:42px;" onclick="viewPlan('Family Unlimited', null, null, '$45.00', '', '', '', '', '', '', 'Unlimited talk, text, and data on 2+ lines.', 0, 'Medium Recommendation', 'pill pill-med'); openReviewUpgrade();">Upgrade Now</button>
                <div class="muted" style="margin-top:6px;"><span class="link" role="button" tabindex="0" onclick="viewPlan('Family Unlimited', null, null, '$45.00', '', '', '', '', '', '', 'Unlimited talk, text, and data on 2+ lines.', 0, 'Medium Recommendation', 'pill pill-med', 'screen-plan-offer');">View Plan Details</span></div>
              </article>
              <!-- Card 3: Premium Speed Tier -->
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Premium Speed Tier</div>
                <div class="row" style="align-items:center; gap:8px; margin-top:4px;">
                  <div class="price" style="font-size:16px;">$85<span class="muted">/mo</span></div>
                  <span class="pill pill-med">Medium Recommendation</span>
                </div>
                <div class="muted" style="margin-top:6px;">Priority data access and higher speeds (e.g., 1000 Mbps).</div>
                <div class="muted" style="margin-top:6px;"><strong>Focus:</strong> The performance upgrade option.</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:6px;">👥 2,100+ Customers upgraded to this tier within the first 6 months.</div>
                 <button class="cta-secondary" style="width:100%; margin-top:28px;" onclick="viewPlan('Premium Speed Tier', null, null, '$85.00', '', '', '', '', '', '', 'Priority data access and higher speeds (e.g., 1000 Mbps).', 0, 'Medium Recommendation', 'pill pill-med'); openReviewUpgrade();">Upgrade Now</button>
                <div class="muted" style="margin-top:6px;"><span class="link" role="button" tabindex="0" onclick="viewPlan('Premium Speed Tier', null, null, '$85.00', '', '', '', '', '', '', 'Priority data access and higher speeds (e.g., 1000 Mbps).', 0, 'Medium Recommendation', 'pill pill-med', 'screen-plan-offer');">View Plan Details</span></div>
              </article>
              <!-- Card 4: Data Saver 15GB -->
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Data Saver 15GB</div>
                <div class="row" style="align-items:center; gap:8px; margin-top:4px;">
                  <div class="price" style="font-size:16px;">$30<span class="muted">/mo</span></div>
                  <span class="pill pill-low">Low Recommendation</span>
                </div>
                <div class="muted" style="margin-top:6px;">15 GB of high‑speed data, then basic speed.</div>
                <div class="muted" style="margin-top:6px;"><strong>Focus:</strong> The lower‑cost alternative.</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:6px;">👥 800+ Customers chose this when their usage patterns shifted to be mostly on Wi‑Fi.</div>
                <button class="cta-secondary" style="width:100%; margin-top:42px;" onclick="viewPlan('Data Saver 15GB', null, null, '$30.00', '', '', '', '', '', '', '15 GB of high‑speed data, then basic speed.', 0, 'Low Recommendation', 'pill pill-low'); openReviewUpgrade();">Upgrade Now</button>
                <div class="muted" style="margin-top:6px;"><span class="link" role="button" tabindex="0" onclick="viewPlan('Data Saver 15GB', null, null, '$30.00', '', '', '', '', '', '', '15 GB of high‑speed data, then basic speed.', 0, 'Low Recommendation', 'pill pill-low', 'screen-plan-offer');">View Plan Details</span></div>
              </article>
            </div>
            <div class="divider" style="margin:12px 0;"></div>
            <div class="plan" style="margin:12px 0 2px; font-size:16px;">Products Based on Your Abandoned Cart</div>
            <div class="muted" style="margin:0 0 8px;">2 Products in your cart worth buying right away!</div>
            <div class="hscroll" style="gap:10px;">
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Fiber Pro Giga Plan</div>
                <div class="row" style="align-items:center; justify-content:space-between; margin-top:6px;">
                  <div class="price" style="font-size:16px;">$75.00<span class="muted">/mo</span></div>
                  <span class="pill pill-high">Still Available!</span>
                </div>
                <div class="muted" style="margin-top:8px;">FREE Activation Fee Waived</div>
                <div class="row" style="margin-top:10px;">
                  <button class="cta-secondary" style="width:100%;">Resume Checkout</button>
                </div>
              </article>
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Samsung Galaxy S24</div>
                <div class="row" style="align-items:center; justify-content:space-between; margin-top:6px;">
                  <div class="price" style="font-size:16px;">$35<span class="muted">/mo</span> <span class="muted">on Installment</span></div>
                  <span class="pill pill-high">Still Available!</span>
                </div>
                <div class="muted" style="margin-top:8px;">FREE Case &amp; Screen Protector Added</div>
                <div class="row" style="margin-top:10px;">
                  <button class="cta-secondary" style="width:100%;">Resume Checkout</button>
                </div>
              </article>
            </div>
          </div>
        </section>

        <!-- Customer Dashboard -->
        <section id="screen-dashboard" class="screen" aria-labelledby="dash-title">
          <header id="dash-title" style="font-weight:700; padding:14px 20px 10px; color:var(--ink); display:flex; align-items:center; justify-content:center; position:relative; background:#eef6ff;">
            <!-- Left menu icon -->
            <div aria-label="Menu" role="button" tabindex="0" style="position:absolute; left:20px; font-size:20px;">☰</div>
            <!-- Centered greeting -->
            <div style="text-align:center;">
              <div class="plan" style="font-size:24px; margin:0;">Hello Jane!</div>
            </div>
            <!-- Right user avatar -->
            <div aria-label="Profile" role="img" style="position:absolute; right:20px; width:32px; height:32px; border-radius:50%; background:#e6eaf0; display:flex; align-items:center; justify-content:center; font-size:16px;">👤</div>
          </header>
          <div class="content">
            <div class="address-top" style="background:#eef6ff; margin-left:-20px; margin-right:-20px; padding:8px 20px 12px;">
              <div class="toolbar" style="margin-top:0; gap:8px; flex-wrap:wrap;">
              <span class="pill risk-high">Data-Heavy User</span>
              <span class="pill risk-low">Night Owl Surfer</span>
              <span class="pill risk-low">Multi-Line Family</span>
              <span class="pill risk-high">Frequent Support Contact</span>
              <span class="pill risk-med">Frequent traveler</span>
              <span class="pill risk-med">Remote-worker</span>
              <span class="pill risk-low">High Account Value (ARPU)</span>
              </div>
            </div>
            <div class="plan" style="margin:16px 0 10px; font-size:16px;">Alerts</div>
            <!-- Overdue banner -->
            <article class="card" style="background:#fff6d6; border:1px solid #f2d27a; margin-bottom:10px;">
              <div class="row" style="align-items:flex-start; display:grid; grid-template-columns:22px 1fr auto; column-gap:10px;">
                <div style="width:22px; height:22px; display:flex; align-items:center; justify-content:center; font-size:18px;">⚠️</div>
                <div class="plan" style="font-size:16px; margin:0; grid-column:2;">Action Required: Your Bill is Overdue</div>
                <button class="cta" style="flex:0 0 auto; white-space:nowrap; grid-column:3; grid-row:1;">Pay Now</button>
              </div>
              <div class="muted" style="margin-top:10px;">To avoid service interruption, please pay your outstanding balance.</div>
            </article>

            <!-- Offers expiring banner -->
            <article class="card" style="background:#fee2e2; border:1px solid #fca5a5; margin-bottom:20px;">
              <div class="row" style="align-items:center; display:grid; grid-template-columns:22px 1fr auto; column-gap:10px;">
                <div style="width:22px; height:22px; display:flex; align-items:center; justify-content:center; font-size:16px;">⏰</div>
                <div class="plan" style="font-size:16px; margin:0; grid-column:2;">Personalized Offers: Expires in 2 hours</div>
                <button class="cta" style="flex:0 0 auto; white-space:nowrap; grid-column:3; grid-row:1;">Explore Offer</button>
              </div>
              <div class="muted" style="margin-top:8px;">Don’t miss out — this limited-time offer is about to expire.</div>
            </article>

            <!-- Usage -->
            <div class="plan" style="margin:24px 0 0; font-size:16px;">Current Cycle Usage (Monthly)</div>
            <div class="muted" style="margin:2px 0 6px;">Resets in 12 days <span class="link link-sm" role="button" tabindex="0">• View Detailed Usage Patterns</span></div>
            <article class="card">
              <div style="margin-bottom:20px;">
                <div class="row" style="justify-content:space-between; margin-bottom:4px;">
                  <div class="plan" style="font-size:14px;">Data</div>
                  <div class="muted" style="text-align:right;">15/20 GB</div>
                </div>
                <div class="progress" style="width:100%;"><div class="progress-fill" style="width:75%;"></div></div>
              </div>
              <div style="margin:20px 0;">
                <div class="row" style="justify-content:space-between; margin-bottom:4px;">
                  <div class="plan" style="font-size:14px;">Voice</div>
                  <div class="muted" style="text-align:right;">350/500 min</div>
                </div>
                <div class="progress" style="width:100%;"><div class="progress-fill" style="width:70%; background:var(--primary);"></div></div>
              </div>
              <div style="margin-top:20px;">
                <div class="row" style="justify-content:space-between; margin-bottom:4px;">
                  <div class="plan" style="font-size:14px;">SMS</div>
                  <div class="muted" style="text-align:right;">800/1000</div>
                </div>
                <div class="progress" style="width:100%;"><div class="progress-fill" style="width:80%; background:var(--primary);"></div></div>
              </div>
            </article>

            <div class="plan" style="margin:24px 0 8px; font-size:16px;">Account Overview</div>

            <!-- List tiles -->
            <article class="card" id="myBillCard">
              <!-- Closed accordion header -->
              <div role="button" tabindex="0" aria-expanded="false" class="row" onclick="toggleMyBill()" style="align-items:center; justify-content:flex-start; gap:10px; width:100%; position:relative;">
                <div style="display:flex; align-items:flex-start; gap:10px;">
                  <div style="position:relative; width:22px; height:22px; display:flex; align-items:center; justify-content:center;">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                      <path d="M20 21V6.8A3.8 3.8 0 0 0 16.2 3H7.8A3.8 3.8 0 0 0 4 6.8V21l2-1.3 2 1.3 2-1.3 2 1.3 2-1.3 2 1.3 2-1.3Z"></path>
                      <path d="M9 7h6"></path>
                      <path d="M7.5 10.5h9"></path>
                      <path d="M7.5 14h9"></path>
                      <path d="M9 17h6"></path>
                    </svg>
                    <span class="badge-dot badge-yellow"></span>
                  </div>
                  <div>
                    <div class="row" style="align-items:center; gap:6px;">
                      <div class="plan" style="font-size:16px; color:#032D60;">My Bill</div>
                    </div>
                    <div class="muted" style="white-space:nowrap;">Current Balance: $75.50</div>
                  </div>
                </div>
                <div id="myBillArrow" class="muted" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); font-size:16px;">▸</div>
              </div>
              <!-- Open accordion body -->
              <div id="myBillBody" class="hidden">
                <div class="divider" style="margin:10px 0; width:100%;"></div>
                <div class="row" style="align-items:flex-start; justify-content:space-between;">
                  <div>
                    <div class="plan" style="font-size:13px; font-weight:500; white-space:nowrap;">Current Balance: $75.50</div>
                    <div class="muted" style="font-size:12px;">(Due: December 15, 2025)</div>
                  </div>
                  <button class="cta" style="white-space:nowrap; flex:0 0 auto; width:auto; min-width:0;">Pay Now</button>
                </div>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="plan" style="font-size:13px; font-weight:500; margin-bottom:6px;">Current Statement Summary:</div>
                <ul class="muted" style="margin:0 0 8px 0; padding:0; list-style:disc inside;">
                  <li style="display:flex; justify-content:space-between; gap:12px;"><span>Plan Charges:</span><span>$69.00</span></li>
                  <li style="display:flex; justify-content:space-between; gap:12px;"><span>Usage Overages:</span><span>$2.00</span></li>
                  <li style="display:flex; justify-content:space-between; gap:12px;"><span>Taxes &amp; Fees:</span><span>$4.50</span></li>
                  <li style="display:flex; justify-content:space-between; gap:12px;"><strong>Total:</strong><strong>$75.50</strong></li>
                </ul>
                <div class="divider" style="margin:10px 0;"></div>
                <div><span class="link" role="button" tabindex="0" style="font-size:13px;">View Full PDF Statement</span></div>
              </div>
            </article>
            <!-- Account Health accordion -->
            <article class="card" id="accHealthCard">
              <div role="button" tabindex="0" aria-expanded="false" class="row" onclick="toggleDash('acc')" style="align-items:center; justify-content:flex-start; gap:10px; width:100%; position:relative;">
                <div style="position:relative; flex:0 0 22px; width:22px; height:22px; display:flex; align-items:center; justify-content:center;">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path>
                    <path d="M9 12h6"></path>
                    <path d="M12 9v6"></path>
                  </svg>
                  <span class="badge-dot badge-green"></span>
                </div>
                <div style="flex:1;">
                  <div class="row" style="align-items:center; gap:6px;">
                    <div class="plan" style="font-size:16px; color:#032D60;">Account Health</div>
                  </div>
                  <div class="muted">Status: Good (85/100)</div>
                </div>
                <div id="accArrow" class="muted" style="margin-left:auto; font-size:16px; position:absolute; right:10px; top:50%; transform:translateY(-50%);">▸</div>
              </div>
              <div id="accBody" class="hidden">
                <div class="divider" style="margin:10px 0; width:100%;"></div>
                <div class="row" style="align-items:center; gap:8px;">
                  <div class="plan" style="font-size:14px; font-weight:700;">Account Health Score: 85/100</div>
                  <span class="pill pill-high">Good</span>
                </div>
                <div class="muted" style="margin-top:6px;">Your account is in excellent standing. You are eligible for the best offers and device financing.</div>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="plan" style="font-size:14px; font-weight:500;">Breakdown Factors</div>
                <ul class="muted" style="margin:6px 0 8px 18px; padding:0;">
                  <li>Payment History: Excellent (100% On‑time payments)</li>
                  <li>Contract Status: Mid‑Contract (12 months remaining)</li>
                  <li>Credit Utilization: Low (No overdue balances)</li>
                  <li>Service Reliability: Excellent (0 service interruptions in the last 6 months)</li>
                </ul>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="plan" style="font-size:14px; font-weight:500;">Recommendations</div>
                <div class="muted" style="margin:4px 0 8px;">Tip: Set up AutoPay to protect your score and avoid late fees.</div>
                <div class="divider" style="margin:10px 0;"></div>
                <div><span class="link" role="button" tabindex="0" style="font-size:13px;">View Health Details</span></div>
              </div>
            </article>
            <!-- Open Issues accordion -->
            <article class="card" id="openIssuesCard">
              <div role="button" tabindex="0" aria-expanded="false" class="row" onclick="toggleDash('issues')" style="align-items:center; justify-content:flex-start; gap:10px; width:100%; position:relative;">
                <div style="position:relative; flex:0 0 22px; width:22px; height:22px; display:flex; align-items:center; justify-content:center;">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="7" x2="12" y2="13"></line>
                    <circle cx="12" cy="17" r="1.5"></circle>
                  </svg>
                  <span class="badge-dot badge-orange"></span>
                </div>
                <div style="flex:1;">
                  <div class="row" style="align-items:center; gap:6px;">
                    <div class="plan" style="font-size:16px; color:#032D60;">Open Issues</div>
                  </div>
                  <div class="muted">1 Unresolved: Slow Data Speeds</div>
                </div>
                <div id="issuesArrow" class="muted" style="margin-left:auto; font-size:16px; position:absolute; right:10px; top:50%; transform:translateY(-50%);">▸</div>
              </div>
              <div id="issuesBody" class="hidden">
                <div class="divider" style="margin:10px 0; width:100%;"></div>
                <div class="row" style="align-items:center; justify-content:space-between; gap:8px; margin-top:4px;">
                  <span class="plan" style="font-size:13px;">• Issue: Slow Data Speed.</span>
                  <span class="pill pill-high">In Progress</span>
                </div>
                <div class="muted" style="margin:2px 0 6px;">
                  <span class="link" role="button" tabindex="0">• Case #T‑12345</span>
                </div>
                <div class="muted" style="margin-top:6px;">Last Update: Technician dispatched to local tower (Estimated resolution: Today, 5:00 PM)</div>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="plan" style="font-size:14px; font-weight:500;">Troubleshooting &amp; Support</div>
                <div class="muted" style="margin:8px 0;">
                  <strong>Action for User:</strong> Before the technician arrives, try restarting your modem/router to see if the issue is resolved.
                </div>
                <div class="muted" style="margin-bottom:8px;">
                  <strong>Communication Log:</strong> Log of all interactions (initial report, automated checks, agent chats).
                </div>
                <div class="row" style="gap:10px; margin-bottom:6px;">
                  <button class="cta-secondary">Chat with an Agent</button>
                  <button class="cta-secondary">Report an issue</button>
                </div>
                <div class="divider" style="margin:10px 0;"></div>
                <div><span class="link" role="button" tabindex="0" style="font-size:13px;">View All Issues</span></div>
              </div>
            </article>
            <!-- Personalized Offers accordion -->
            <article class="card" id="offersCard">
              <div role="button" tabindex="0" aria-expanded="true" class="row" onclick="toggleDash('offers')" style="align-items:center; justify-content:flex-start; gap:10px; width:100%; position:relative;">
                <div style="position:relative; flex:0 0 22px; width:22px; height:22px; display:flex; align-items:center; justify-content:center;">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M7.5 3l11-1-.5 11L10 21 3 14l4.5-11z"></path>
                    <circle cx="16.5" cy="6" r="1.5"></circle>
                    <circle cx="9.5" cy="13" r="1.5"></circle>
                    <path d="M14 8l-5 5"></path>
                  </svg>
                  <span class="badge-dot badge-red"></span>
                </div>
                <div style="flex:1;">
                  <div class="row" style="align-items:center; gap:6px;">
                    <div class="plan" style="font-size:16px; color:#032D60;">Personalized Offers</div>
                  </div>
                  <div class="muted">You have a new offer waiting!</div>
                </div>
                <div id="offersArrow" class="muted" style="margin-left:auto; font-size:16px; position:absolute; right:10px; top:50%; transform:translateY(-50%);">▾</div>
              </div>
              <div id="offersBody">
                <div class="divider" style="margin:10px 0; width:100%;"></div>
                <!-- Highlighted Offer -->
                <article class="card" role="region" aria-label="Top personalized offer" style="background:#eef6ff; border-color:#c9defc;">
                  <div class="row" style="align-items:center; justify-content:space-between;">
                    <div class="plan" style="font-size:16px; color:#032D60;">Upgrade to Unlimited Data</div>
                    <span class="pill pill-high">Highly Recommended</span>
                  </div>
                  <div class="muted" style="margin-top:6px;">
                    Unlock 5G speeds and truly unlimited data for just $10 more per month.
                  </div>
                  <div class="row" style="margin-top:10px;">
                    <button class="cta" onclick="goto('screen-offer-special')">Explore this Offer</button>
                  </div>
                </article>
                <div class="divider" style="margin:12px 0;"></div>
                <!-- Other Offers -->
                <div class="plan" style="font-size:14px; font-weight:500;">Other Offers</div>
                <div style="margin-top:8px; display:grid; gap:6px;">
                  <article class="card" style="margin:0;">
                    <div class="plan" style="font-size:11px; color:#6b7280; text-transform:uppercase; letter-spacing:.3px; margin-bottom:2px;">Plan Upgrade</div>
                    <div class="plan" style="font-size:14px;">Trade‑in &amp; Upgrade Discount</div>
                    <div class="muted" style="margin-top:4px;">Get $200 off the new [Device Name] when you switch to our Premium plan.</div>
                    <div class="row" style="margin-top:8px;">
                      <button class="cta-secondary" onclick="goto('screen-offer-special')">Explore this Offer</button>
                    </div>
                  </article>
                  <article class="card" style="margin:0;">
                    <div class="plan" style="font-size:11px; color:#6b7280; text-transform:uppercase; letter-spacing:.3px; margin-bottom:2px;">Add‑on/Bundle</div>
                    <div class="plan" style="font-size:14px;">Secure Family Bundle</div>
                    <div class="muted" style="margin-top:4px;">Add device protection and parental controls for 2 lines for 20% off.</div>
                    <div class="row" style="margin-top:8px;">
                      <button class="cta-secondary" onclick="goto('screen-offer-special')">Explore this Offer</button>
                    </div>
                  </article>
                  <article class="card" style="margin:0;">
                    <div class="plan" style="font-size:11px; color:#6b7280; text-transform:uppercase; letter-spacing:.3px; margin-bottom:2px;">Retention/Loyalty</div>
                    <div class="plan" style="font-size:14px;">Free HBO Max Subscription</div>
                    <div class="muted" style="margin-top:4px;">As a thank you for your loyalty, enjoy 6 months of streaming on us.</div>
                    <div class="row" style="margin-top:8px;">
                      <button class="cta-secondary" onclick="goto('screen-offer-special')">Explore this Offer</button>
                    </div>
                  </article>
                </div>
                <div class="divider" style="margin:12px 0;"></div>
                <div><span class="link" role="button" tabindex="0" style="font-size:13px;">See All Available Offers</span></div>
              </div>
            </article>
          </div>
          <div class="sticky" style="background:#fff; border-top:1px solid var(--line); padding:12px 20px;">
            <div class="row" style="justify-content:center; width:100%; gap:36px;">
              <div role="button" tabindex="0" onclick="goto('screen-dashboard')" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                <div style="width:18px; height:18px;">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#401075" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <rect x="3" y="3" width="9" height="13" rx="2"></rect>
                    <rect x="14" y="3" width="7" height="7" rx="2"></rect>
                    <rect x="14" y="12" width="7" height="9" rx="2"></rect>
                    <rect x="3" y="18" width="9" height="3" rx="2"></rect>
                  </svg>
                </div>
                <div class="plan" style="font-size:12px; color:#401075;">Dashboard</div>
              </div>
              <div role="button" tabindex="0" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                <div style="width:18px; height:18px;">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M20 21V6.8A3.8 3.8 0 0 0 16.2 3H7.8A3.8 3.8 0 0 0 4 6.8V21l2-1.3 2 1.3 2-1.3 2 1.3 2-1.3 2 1.3 2-1.3Z"></path>
                    <path d="M9 7h6"></path>
                    <path d="M7.5 10.5h9"></path>
                    <path d="M7.5 14h9"></path>
                    <path d="M9 17h6"></path>
                  </svg>
                </div>
                <div class="muted" style="font-size:12px;">Bills</div>
              </div>
              <div role="button" tabindex="0" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                <div style="width:18px; height:18px;">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M3 4h3l2 7h11.5a1 1 0 0 0 .96-.71l1.4-4.29A1 1 0 0 0 21 5h-5"></path>
                    <path d="M9 11l-1.5-5"></path>
                    <circle cx="10" cy="19" r="2"></circle>
                    <circle cx="18" cy="19" r="2"></circle>
                    <path d="M8 19h8"></path>
                  </svg>
                </div>
                <div class="muted" style="font-size:12px;">Shop</div>
              </div>
              <div role="button" tabindex="0" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                <div style="width:18px; height:18px;">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M4 12a8 8 0 0 1 16 0"></path>
                    <rect x="3" y="12" width="4" height="7" rx="2"></rect>
                    <rect x="17" y="12" width="4" height="7" rx="2"></rect>
                    <circle cx="12" cy="20" r="2"></circle>
                    <path d="M12 18v2"></path>
                  </svg>
                </div>
                <div class="muted" style="font-size:12px;">Support</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Plan Details - Full -->
        <section id="screen-plan-full" class="screen" aria-labelledby="planfull-title">
          <header id="planfull-title" style="font-weight:700; padding:12px 20px 8px; color:#401075; display:flex; align-items:center; justify-content:center; position:relative; background:#eef6ff;">
            <span role="button" tabindex="0" onclick="goto('screen-results-reco')" style="position:absolute; left:20px; cursor:pointer;">←</span>
            <span>View Plan Details</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <article class="card" role="article" aria-label="Plan summary" style="background:#fff;">
                <div style="display:flex; flex-direction:column; align-items:flex-start; gap:6px; margin-top:4px;">
                  <span id="pdRecoPill" class="pill pill-high" aria-live="polite" style="width:max-content;">Highly Recommended</span>
                  <div class="plan" id="pdName" style="font-size:18px;">Plan Name</div>
                </div>
                <div class="price" id="pdPrice" style="font-size:18px; margin-top:4px; color:#000000;">$59.99<span class="muted">/mo</span></div>
                <div class="muted" id="pdDesc" style="margin-top:6px;">500 Mbps download • 50 Mbps upload</div>
                <div id="pdEta" class="muted" style="margin-top:4px; color:#000000;">Activation ETA: 2 days</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:4px; color: #000000;;">👥 40 people in your area bought this product in past 6 months</div>
                <span class="pill" style="margin-top:8px; width:max-content;">🔒 Price Lock</span>
              </article>
            </div>

            <!-- Why this product for you? (accordion, closed by default) -->
            <!-- Why this product for you? header outside the card -->
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">Why this product for you?</div>
            </div>
            <article id="accWhyBody" class="card" style="margin-top:8px;">
              <!-- Item 1 -->
              <div>
                <div class="plan" id="pdWhy1Title">Optimal for Gaming &amp; Streaming</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Performance and Usage Affinity.</li>
                  <li><strong>Intent:</strong> <span id="pdWhy1Desc" style="font-style:italic;">Based on your stated activities.</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Pro‑Speed for Streaming — Perfect bandwidth for 4K video &amp; lag‑free gaming.</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <!-- Item 2 -->
              <div>
                <div class="plan" id="pdWhy2Title">Covers All Your Devices</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Product Preference and Scale.</li>
                  <li><strong>Intent:</strong> <span id="pdWhy2Desc" style="font-style:italic;">For your family of 4.</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Covers Your Whole Household — Validated for simultaneous use by 4+ devices/users.</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <!-- Item 3 -->
              <div>
                <div class="plan" id="pdWhy3Title">Best Speed in Your Area</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Feasibility and Coverage.</li>
                  <li><strong>Intent:</strong> <span id="pdWhy3Desc" style="font-style:italic;">Based on feasibility check</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Best Speed at Your Address — Guaranteed 500 Mbps based on feasibility check.</div>
              </div>
            </article>
            </article>

            <!-- What it includes (accordion, closed by default) -->
            <!-- What it includes header outside the card -->
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">What it includes</div>
            </div>
            <article id="accIncBody" class="card" style="margin-top:8px;">
                <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Download Speed</div>
                <div class="plan" id="pdIncDown" style="font-size:13px;">500 Mbps</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Upload Speed</div>
                <div class="plan" id="pdIncUp" style="font-size:13px;">50 Mbps</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Data Allowance</div>
                <div class="plan" id="pdAllowance" style="color:#1a7f3c; font-size:13px;">Unlimited</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Contract Length</div>
                <div class="plan" id="pdContract" style="font-size:13px;">24 months</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Equipment</div>
                <div class="plan" id="pdEquipment" style="color:#1a7f3c; font-size:13px;">Free Wi‑Fi 6 Router</div>
              </div>
            </article>
            </article>

            <!-- Pricing Breakdown (accordion, closed by default) -->
            <!-- Pricing Breakdown header outside the card -->
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">Pricing Breakdown</div>
            </div>
            <article id="accPriceBody" class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Monthly Plan Rate</div>
                <div class="plan" id="pdPriceRate">$0.00 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Regulatory &amp; Admin Fees</div>
                <div class="muted" id="pdRegFee">$5.99 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Estimated Taxes</div>
                <div class="muted" id="pdTax">~ 6% of base rate</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Total Estimated Monthly Bill</div>
                <div class="plan" id="pdTotal">$0.00</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">One‑Time Activation Fee</div>
                <div class="muted" id="pdActFee">$35.00 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Installation Fee</div>
                <div class="muted" id="pdInstall">Setup is free</div>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="flex:0 0 auto" onclick="openReview('screen-plan-full')">Activate this Plan</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-results-reco')">View Other Plans</span></div>
          </div>
        </section>
        <!-- Plan Details - Offer (Explore Offers flow) -->
        <section id="screen-plan-offer" class="screen" aria-labelledby="planoffer-title">
          <header id="planoffer-title" style="font-weight:700; color:#401075; padding:12px 20px 8px; color:var(--ink); display:flex; align-items:center; justify-content:center; position:relative; background:#eef6ff;">
            <span role="button" tabindex="0" onclick="goto('screen-offer-special')" style="position:absolute; left:20px; cursor:pointer;">←</span>
            <span>View Plan Details</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <article class="card" role="article" aria-label="Plan summary (offer)" style="background:#fff;">
                <div class="row" style="align-items:center; justify-content:space-between; margin-top:4px;">
                  <div class="plan" id="pdOName" style="font-size:18px;">Plan Name</div>
                  <span id="pdORecoPill" class="pill pill-high" aria-live="polite">Highly Recommended</span>
                </div>
                <div class="price" id="pdOPrice" style="font-size:18px; margin-top:4px;">$0.00<span class="muted">/mo</span></div>
                <div class="muted" id="pdODesc" style="margin-top:6px;">—</div>
                <div id="pdOEta" class="muted" style="margin-top:4px;">Activation ETA: —</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:4px;">👥 40 people in your area bought this product in past 6 months</div>
                <span class="pill" style="margin-top:8px; width:max-content;">🔒 Price Lock</span>
              </article>
            </div>
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">Why this product for you?</div>
            </div>
            <article id="accWhyBodyO" class="card" style="margin-top:8px;">
              <div>
                <div class="plan" id="pdOWhy1Title">Optimal for Gaming &amp; Streaming</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Performance and Usage Affinity.</li>
                  <li><strong>Intent:</strong> <span id="pdOWhy1Desc" style="font-style:italic;">Based on your stated activities.</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Pro‑Speed for Streaming — Perfect bandwidth for 4K video &amp; lag‑free gaming.</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div>
                <div class="plan" id="pdOWhy2Title">Covers All Your Devices</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Product Preference and Scale.</li>
                  <li><strong>Intent:</strong> <span id="pdOWhy2Desc" style="font-style:italic;">For your family of 4.</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Covers Your Whole Household — Validated for simultaneous use by 4+ devices/users.</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div>
                <div class="plan" id="pdOWhy3Title">Best Speed in Your Area</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Feasibility and Coverage.</li>
                  <li><strong>Intent:</strong> <span id="pdOWhy3Desc" style="font-style:italic;">Based on feasibility check</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Best Speed at Your Address — Guaranteed 500 Mbps based on feasibility check.</div>
              </div>
            </article>
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">What it includes</div>
            </div>
            <article id="accIncBodyO" class="card" style="margin-top:8px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Download Speed</div>
                <div class="plan" id="pdOIncDown" style="font-size:13px;">—</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Upload Speed</div>
                <div class="plan" id="pdOIncUp" style="font-size:13px;">—</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Data Allowance</div>
                <div class="plan" id="pdOAllowance" style="color:#1a7f3c; font-size:13px;">Unlimited</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Contract Length</div>
                <div class="plan" id="pdOContract" style="font-size:13px;">24 months</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Equipment</div>
                <div class="plan" id="pdOEquipment" style="color:#1a7f3c; font-size:13px;">Free Wi‑Fi 6 Router</div>
              </div>
            </article>
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">Pricing Breakdown</div>
            </div>
            <article id="accPriceBodyO" class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Monthly Plan Rate</div>
                <div class="plan" id="pdOPriceRate">$0.00 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Regulatory &amp; Admin Fees</div>
                <div class="muted" id="pdORegFee">$5.99 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Estimated Taxes</div>
                <div class="muted" id="pdOTax">~ 6% of base rate</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Total Estimated Monthly Bill</div>
                <div class="plan" id="pdOTotal">$0.00</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">One‑Time Activation Fee</div>
                <div class="muted" id="pdOActFee">$35.00 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Installation Fee</div>
                <div class="muted" id="pdOInstall">Setup is free</div>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="flex:0 0 auto" onclick="openReviewUpgrade()">Upgrade Now</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-offer-special')">Back to Offers</span></div>
          </div>
        </section>
        <!-- Modify Plan (Offer flow) -->
        <section id="screen-modify" class="screen" aria-labelledby="modify-title">
          <div class="address-top" style="position:relative; padding-top:70px;">
            <span role="button" tabindex="0" onclick="goto('screen-offer-special')" style="position:absolute; left:20px; top:8px; cursor:pointer;">←</span>
            <h1 id="modify-title" class="display-h1" style="font-size:24px; font-weight:800; line-height:1.25; margin:0; padding-bottom:2px; text-align:center;">Let's Modify your Plan!</h1>
            <p class="subhead" style="margin:6px 16px 42px; line-height:1.4; font-size:14px; text-align:center;">
              Easily customize your current plan, add boosters, or explore new plan tiers. Your estimated cost impact is updated in real-time
            </p>
            <article class="card" style="margin:6px auto 28px; background:#fff; width:80%;">
              <div class="plan" style="font-size:16px;">Change Data Limit</div>
              <div class="row" style="align-items:baseline; justify-content:flex-start; margin-top:6px;">
                <div class="plan" id="modGbVal" style="font-size:28px; white-space:nowrap;">20 <span class="muted" style="font-size:14px;">GB</span></div>
              </div>
              <div style="position:relative; margin-top:8px;">
                <input id="modGbSlider" type="range" min="5" max="100" value="20" oninput="onModifySlider(this.value)" style="width:100%;">
                <span class="muted" id="modRecPlan" style="position:absolute; right:0; top:-16px;">Recommended Plan</span>
                <span class="muted" id="modMaxLabel" style="position:absolute; right:0; bottom:-16px;">100 GB</span>
              </div>
              <div class="row" style="justify-content:flex-start;">
                <div class="muted">5 GB</div>
              </div>
              <div style="background:#eef6ff; border:1px solid #dbeafe; padding:10px; border-radius:12px; margin-top:12px;">
                <div class="muted">ℹ️ Your estimated monthly cost will adjust based on the data limit you select.</div>
              </div>
            </article>
          </div>
          <div class="content" style="padding-top:8px;">
            <div class="plan" style="font-size:16px;">Add Boosters</div>
            <div class="muted" style="margin-top:4px;">One‑time additions to your plan. Expires at the end of your billing cycle.</div>
            <article class="card" style="margin-top:8px;">
              <div class="row" style="align-items:center; justify-content:space-between; margin-top:12px;">
                <div>
                  <div class="plan" style="font-size:14px;">Extra Data</div>
                  <div class="muted">+5 GB</div>
                </div>
                <button id="btnBoostData" class="cta-secondary" style="flex:0 0 auto; white-space:nowrap; width:120px;" onclick="toggleBooster('data')">Add +$10</button>
              </div>
              <div class="row" style="align-items:center; justify-content:space-between; margin-top:12px;">
                <div>
                  <div class="plan" style="font-size:14px;">Int'l Calls</div>
                  <div class="muted">100 Mins</div>
                </div>
                <button id="btnBoostIntl" class="cta-secondary" style="flex:0 0 auto; white-space:nowrap; width:120px;" onclick="toggleBooster('intl')">Add +$05</button>
              </div>
            </article>
            <div class="divider" style="margin-top:12px;"></div>
            <div style="margin-top:12px;">
              <div class="plan" style="font-size:16px;">Explore Other Plans</div>
              <!-- Card: Fiber 500 -->
              <article class="card" style="margin-top:8px;">
                <div class="row" style="align-items:center; justify-content:space-between;">
                  <div class="plan" style="color:#032D60; font-size:16px;">Fiber 500</div>
                  <span class="pill pill-med">Medium Recommended</span>
                </div>
                <div class="price" style="font-size:22px; margin:4px 0;">$55 <span class="muted">/mo</span></div>
                <div class="feat">500 Mbps • Unlimited • ETA: 2 days</div>
                <div class="row" style="margin-top:6px;">
                  <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;" onclick="viewPlan('Fiber 500', 500, 50, '$55.00', 'Unlimited', 'Free Wi‑Fi 6 Router', 'Optimal for Gaming & Streaming', 'Based on your stated activities', 'Best Speed in Your Area', 'Based on feasibility check', '500 Mbps • Unlimited • ETA: 2 days', 2, null, null, 'screen-plan-offer')">• View Details</span>
                </div>
              </article>
              <!-- Card: Fiber 300 -->
              <article class="card">
                <div class="row" style="align-items:center; justify-content:space-between;">
                  <div class="plan" style="color:#032D60; font-size:16px;">Fiber 300</div>
                  <span class="pill pill-med">Medium Recommended</span>
                </div>
                <div class="price" style="font-size:22px; margin:4px 0;">$40 <span class="muted">/mo</span></div>
                <div class="feat">300 Mbps • Unlimited • ETA: 3 days</div>
                <div class="row" style="margin-top:6px;">
                  <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;" onclick="viewPlan('Fiber 300', 300, 30, '$40.00', 'Unlimited', 'Wi‑Fi 6 Router', 'Great for Everyday Use', 'Streaming, browsing, and video calls', 'Budget Friendly', 'Best price/performance', '300 Mbps • Unlimited • ETA: 3 days', 3, null, null, 'screen-plan-offer')">• View Details</span>
                </div>
              </article>
              <!-- Card: Basic 100 -->
              <article class="card">
                <div class="row" style="align-items:center; justify-content:space-between;">
                  <div class="plan" style="color:#032D60; font-size:16px;">Basic 100</div>
                  <span class="pill pill-low">Low Recommended</span>
                </div>
                <div class="price" style="font-size:22px; margin:4px 0;">$29 <span class="muted">/mo</span></div>
                <div class="feat">100 Mbps • Unlimited • ETA: 3–5 days</div>
                <div class="row" style="margin-top:6px;">
                  <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;" onclick="viewPlan('Basic 100', 100, 10, '$29.00', 'Unlimited', 'Standard Wi‑Fi Router', 'Reliable Essentials', 'Email, browsing, light streaming', 'Entry Plan', 'Good for 1–2 users', '100 Mbps • Unlimited • ETA: 3–5 days', 4, null, null, 'screen-plan-offer')">• View Details</span>
                </div>
              </article>
            </div>
          </div>
          <div class="sticky" style="align-items:stretch; gap:8px; flex-direction:column;">
            <div class="row" style="align-items:baseline; padding:10px 0;">
              <div class="plan" style="font-size:14px; font-weight:700; white-space:nowrap;">Estimated Cost Impact</div>
              <div id="modEst" class="plan" style="color:#16a34a; font-size:18px; margin-left:auto; text-align:right;">+$0.00<span class="muted">/mo</span></div>
            </div>
            <button class="cta" onclick="confirmModify()">Confirm Changes</button>
          </div>
        </section>
        <!-- Results - Recommended (Sixth Screen) -->
        <section id="screen-results-reco" class="screen" aria-labelledby="reco-title">
          <div class="reco-top" style="position:relative;">
            <span role="button" tabindex="0" onclick="goto('screen-basics')" style="position:absolute; top:8px; left:20px; cursor:pointer;">←</span>
            <img id="topPickIcon" class="reco-hero" src="./assets/Toppick-icon.svg" alt="Top pick icon" style="width:104px; height:104px; object-fit:contain; margin-top:80px; margin-bottom:20px; filter:drop-shadow(0 12px 24px rgba(11,19,36,.20));" />
            <header id="reco-title" class="center" style="font-size:28px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0; margin-bottom:10px;">Your personalised bundle is ready!</header>
            <p class="subhead center" style="margin:6px 20px 8px; font-size:18px; margin-bottom:40px;">
              Customised configuration built by the AI based on your needs and financing
            </p>
            
            <div class="content" style="padding-top:8px;">
              <!-- Product Card -->
              <article class="card" role="article" aria-label="Personalised bundle" style="background:#fff;">
                <div><span class="elig">Best for Monthly Savings</span></div>
                <div class="plan" style="font-size:18px; color:#032D60; font-weight:700; margin-top:6px;">Samsung Galaxy S24 FE</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="row" style="margin-top:12px; margin-bottom:12px; align-items:flex-start; justify-content:space-between;">
                  <div style="flex:1;">
                    <div class="muted" style="font-weight:600;">Monthly Price</div>
                    <div class="price" style="font-size:22px;">$55.00<span class="muted">/mo</span></div>
              </div>
                  <div style="flex:1; text-align:right;">
                    <div class="muted" style="font-weight:600;">Total Upfront Cost</div>
                    <div class="price" style="font-size:22px;">$199.00</div>
                    <div class="muted" style="font-size:12px;">(After trade-in credit)</div>
                </div>
                </div>
                <div class="feat" style="margin-top:8px;"><strong>Plan:</strong> Data Saver 15GB (15GB/mo high-speed data)</div>
                <div class="feat" style="margin-top:4px;"><strong>Key Trade‑Offs:</strong> Data limit of 15GB (risk of throttling after cap); Device is mid‑tier processor.</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="feat" style="margin-top:0;"><strong>Why this choice:</strong> Best value for your budget. We matched your $50–60/mo target by maximizing your trade‑in credit.</div>
                <button class="cta" style="width:100%; margin-top:12px;" onclick="startCoDesign('Samsung Galaxy S24 FE')">Pick & Co‑Design</button>
                <div class="row" style="margin-top:8px;">
                  <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare</button>
                  <button class="cta-secondary" style="flex:1" onclick="goto('screen-match')">Regenerate</button>
                </div>
              </article>
            </div>
          </div>
          <!-- Rest of details on white -->
          <div class="content" style="padding-top:8px;">
            <!-- Additional personalised bundles -->
            <article class="card" role="article" aria-label="Personalised bundle - iPhone 17 Pro Max" style="background:#fff;">
              <div><span class="elig">Best Performance</span></div>
              <div class="plan" style="font-size:18px; color:#032D60; font-weight:700; margin-top:6px;">iPhone 17 Pro Max</div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:12px; margin-bottom:12px; align-items:flex-start; justify-content:space-between;">
                <div style="flex:1;">
                  <div class="muted" style="font-weight:600;">Monthly Price</div>
                  <div class="price" style="font-size:22px;">$115.00<span class="muted">/mo</span></div>
              </div>
                <div style="flex:1; text-align:right;">
                  <div class="muted" style="font-weight:600;">Total Upfront Cost</div>
                  <div class="price" style="font-size:22px;">$399.00</div>
              </div>
              </div>
              <div class="feat" style="margin-top:8px;"><strong>Plan:</strong> Unlimited 5G+ Premium (Priority data, 50GB hotspot)</div>
              <div class="feat" style="margin-top:4px;"><strong>Key Trade‑Offs:</strong> Highest monthly bill; requires credit approval for maximum financing term.</div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="feat" style="margin-top:0;"><strong>Why this choice:</strong> Maximized performance for streaming and gaming. Ideal for your high‑data usage affinity.</div>
              <button class="cta" style="width:100%; margin-top:12px;" onclick="startCoDesign('iPhone 17 Pro Max')">Pick & Co‑Design</button>
              <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare</button>
                <button class="cta-secondary" style="flex:1" onclick="goto('screen-match')">Regenerate</button>
              </div>
            </article>
            <article class="card" role="article" aria-label="Personalised bundle - Google Pixel 8a" style="background:#fff; margin-top:16px;">
              <div><span class="elig">Low Upfront Cost</span></div>
              <div class="plan" style="font-size:18px; color:#032D60; font-weight:700; margin-top:6px;">Google Pixel 8a</div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:12px; margin-bottom:12px; align-items:flex-start; justify-content:space-between;">
                <div style="flex:1;">
                  <div class="muted" style="font-weight:600;">Monthly Price</div>
                  <div class="price" style="font-size:22px;">$79.00<span class="muted">/mo</span></div>
              </div>
                <div style="flex:1; text-align:right;">
                  <div class="muted" style="font-weight:600;">Total Upfront Cost</div>
                  <div class="price" style="font-size:22px;">$0.00</div>
                  <div class="muted" style="font-size:12px;">(No trade-in required; device financed)</div>
              </div>
              </div>
              <div class="feat" style="margin-top:8px;"><strong>Plan:</strong> Basic Talk & Text (Unlimited calls/text, 5GB data)</div>
              <div class="feat" style="margin-top:4px;"><strong>Key Trade‑Offs:</strong> Very limited data (5GB); Device has a standard battery life.</div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="feat" style="margin-top:0;"><strong>Why this choice:</strong> Zero payment today. We prioritized eliminating the upfront cost as requested in your budget input.</div>
              <button class="cta" style="width:100%; margin-top:12px;" onclick="startCoDesign('Google Pixel 8a')">Pick & Co‑Design</button>
              <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare</button>
                <button class="cta-secondary" style="flex:1" onclick="goto('screen-match')">Regenerate</button>
            </div>
              </article>
            </div>
          <!-- Explore Other Plans section removed -->
          <!-- Removed 'Browse all active plans' sticky footer -->
        </section>

        <!-- Personalize (Step 4) -->
        <section id="screen-personalize" class="screen" aria-labelledby="personalize-title">
          <div class="address-top">
            <div class="dots" aria-hidden="true"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot active"></span></div>
            <!-- Personalize icon from assets (cache-busted) -->
            <img id="personalizeIcon" src="./assets/your-icon.svg" alt="Personalize icon" style="display:block; margin:12px auto 6px; width:64px; height:64px;" />
            <h1 id="personalize-title" class="display-h1" style="font-size:24px; font-weight:600; line-height:1.25; margin:0; padding-bottom:2px;">Let's Personalise your plan!</h1>
            <p class="subhead" style="margin:4px 20px 8px; line-height:1.4; font-size:14px;">Answer few questions to get more tailored recommendations</p>
          </div>
          <div class="content" style="padding-top:8px;">
            <!-- Budget options -->
            <div style="margin-bottom:16px;">
              <div class="section-title">What's your typical monthly budget for a service plan?</div>
              <div class="toolbar" id="qBudgetGroup" role="radiogroup" aria-label="Budget">
                <span class="chip chip-toggle" onclick="selectBudget(this,'$50')">$50</span>
                <span class="chip chip-toggle" onclick="selectBudget(this,'$100')">$100</span>
                <span class="chip chip-toggle" onclick="selectBudget(this,'$120')">$120</span>
                <span class="chip chip-toggle" onclick="selectBudget(this,'$150')">$150</span>
              </div>
            </div>
            <div class="divider"></div>
            <!-- Data usage chips (4 steps) -->
            <div style="margin-bottom:16px;">
              <div class="section-title">What is your primary need for data each month?</div>
              <div class="subtle" style="margin-top:4px;">Light: Mostly Wi‑Fi • Moderate: Daily social/media music • Heavy: HD streaming/hotspot/gaming • Unlimited: Don’t want limits</div>
              <div class="toolbar" id="qDataGroup" role="radiogroup" aria-label="Monthly data need" style="margin-top:10px;">
                <span class="chip chip-toggle" onclick="selectDataNeed(this,'Light Use')">Light Use</span>
                <span class="chip chip-toggle" onclick="selectDataNeed(this,'Moderate Use')">Moderate Use</span>
                <span class="chip chip-toggle" onclick="selectDataNeed(this,'Heavy Use')">Heavy Use</span>
                <span class="chip chip-toggle" onclick="selectDataNeed(this,'Unlimited')">Unlimited</span>
              </div>
            </div>
            <div class="divider"></div>
            <!-- Streaming frequency chips -->
            <div style="margin-bottom:16px;">
              <div class="section-title">How often do you stream HD video or game on your mobile data?</div>
              <div class="subtle" style="margin-top:4px;">
                Occasionally: A few times a month • Often: Daily while commuting/traveling
              </div>
              <div class="toolbar" id="qStreamGroup" role="radiogroup" aria-label="Streaming frequency" style="margin-top:10px;">
                <span class="chip chip-toggle" onclick="selectStream(this,'Never / Rarely')">Never / Rarely</span>
                <span class="chip chip-toggle" onclick="selectStream(this,'Occasionally')">Occasionally</span>
                <span class="chip chip-toggle" onclick="selectStream(this,'Often')">Often</span>
                <span class="chip chip-toggle" onclick="selectStream(this,'It’s Essential')">It’s Essential</span>
              </div>
            </div>
            <div class="divider"></div>
            <!-- Lines chips -->
            <div style="margin-bottom:16px;">
              <div class="section-title">How many lines/users do you need on your plan?</div>
              <div class="toolbar" id="qLinesGroup" role="radiogroup" aria-label="Lines/users">
                <span class="chip chip-toggle" onclick="selectLinesChip(this,'Just for me (1)')">Just for me (1)</span>
                <span class="chip chip-toggle" onclick="selectLinesChip(this,'For my partner and me (2)')">For my partner and me (2)</span>
                <span class="chip chip-toggle" onclick="selectLinesChip(this,'Small Family (3–4)')">Small Family (3–4)</span>
                <span class="chip chip-toggle" onclick="selectLinesChip(this,'Large Family (5+)')">Large Family (5+)</span>
              </div>
            </div>
            <div class="divider"></div>
            <!-- International radio -->
            <div style="margin-bottom:24px;">
              <div class="section-title">Do you frequently travel internationally or call/text abroad?</div>
              <div class="toolbar" id="qIntlGroup" role="radiogroup" aria-label="International usage">
                <span class="chip chip-toggle" onclick="selectIntl(this,true)">Yes</span>
                <span class="chip chip-toggle" onclick="selectIntl(this,false)">No</span>
              </div>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="personalizeCta" class="cta cta-lg btn-disabled" style="flex:0 0 auto" onclick="goto('screen-match')">Find Matching Plans</button>
            <button class="cta-secondary" style="width:100%;" onclick="goto('screen-processing')">Back</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-match')">Skip for now</span></div>
          </div>
        </section>
        <!-- Match (Step 5) -->
        <section id="screen-match" class="screen" aria-labelledby="match-title">
          <div class="welcome-top" style="min-height:50vh; padding-bottom:8px; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <div class="dots" aria-hidden="true" style="margin-top:6px; margin-bottom:6px;"><span class="dot"></span><span class="dot"></span><span class="dot active"></span></div>
            <!-- search icon on top -->
            <img id="matchSearchIcon" src="./assets/search-icon.svg" alt="Search" style="display:block; margin:12px auto 16px; width:104px; height:104px; filter:drop-shadow(0 12px 24px rgba(11,19,36,.20));" />
            <header id="match-title" class="center" style="font-size:28px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0; margin-bottom:10px;">Creating your bundle options!</header>
            <p class="muted center" style="margin:4px 20px 8px; line-height:1.4; font-size:18px;">
              Comparing financing and discounts to guarantee your best overall configuration
            </p>
          </div>
          <div class="content center" style="padding-top:12px;">
            <!-- selected meta tags -->
            <div id="matchChips" class="toolbar" style="justify-content:center; margin:6px auto 8px; max-width:560px;"></div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:6px; align-items:center;">
            <div class="progress-row" style="width:90%; max-width:520px;">
              <div class="muted" style="font-size:14px;">Searching...</div>
              <div class="muted" style="font-size:14px;" id="matchPctLabel">0%</div>
            </div>
            <div class="progress"><div class="progress-fill" id="matchFill"></div></div>
            <div class="subtle" style="margin-top:2px;">Almost there!</div>
          </div>
        </section>
        <!-- Entry -->
        <section id="screen-entry" class="screen" aria-labelledby="entry-title">
          <header id="entry-title">Welcome</header>
          <div class="content">
            <p class="muted">See only plans available at your address — compare & activate in minutes.</p>
            <div class="stack" role="group" aria-label="Entry options">
            <button class="cta-secondary" onclick="goto('screen-address')">New customer</button>
              <button class="cta-secondary">Returning customer</button>
              <button class="cta-secondary">Port my number</button>
              <button class="cta-secondary">Explore as guest</button>
            </div>
            <h3>Location & Address</h3>
            <p class="muted">We use your address to show eligible plans. You can edit anytime.</p>
            <div class="stack">
              <button class="cta-secondary" onclick="permissionLocation()">Allow location</button>
              <button class="cta-secondary" onclick="goto('screen-address')">Enter address</button>
            </div>
          </div>
          <div class="sticky">
            <button class="cta" style="flex:1" onclick="goto('screen-address')">Continue</button>
          </div>
        </section>

        <!-- Address -->
        <section id="screen-address" class="screen" aria-labelledby="address-title">
          <div class="address-top">
            <div class="dots" aria-hidden="true"><span class="dot"></span><span class="dot active"></span><span class="dot"></span><span class="dot"></span></div>
            <div class="hero-address" aria-hidden="true">
              <img id="addressIcon" src="./assets/address-icon.svg" alt="Address verification icon" />
            </div>
            <h1 id="address-title" class="display-h1" style="font-size:24px; font-weight:600; line-height:1.25; margin:0; padding-bottom:2px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;">Let's Verify<br/>Your Service Address!</h1>
            <p class="subhead" style="margin:4px 20px 24px; line-height:1.4; font-size:14px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;">Enter your complete address to instantly check which plans are available to you.</p>
          </div>
          <div class="content" style="padding-top:0;">
            <!-- Section 1 -->
            <div>
              <div class="section-title">Your Full Address<span class="req" aria-hidden="true">*</span></div>
              <label class="subtle" for="addr_street" style="display:block; margin-top:6px;">Street Address <span class="req" aria-hidden="true">*</span></label>
              <input id="addr_street" type="text" placeholder="Street Address" aria-required="true" required oninput="onAddressInputChange()" onkeydown="onEnterVerify(event)" />

              <label class="subtle" for="addr_line2" style="display:block; margin-top:8px;">Address Line 2</label>
              <input id="addr_line2" type="text" placeholder="Apartment, suite, unit, etc. (optional)" oninput="onAddressInputChange()" onkeydown="onEnterVerify(event)" />

              <div class="row address-split" style="margin-top:10px; gap:13px;">
                <div style="margin-right:16px;">
                  <label class="subtle" for="addr_city" style="display:block;">City <span class="req" aria-hidden="true">*</span></label>
                  <input id="addr_city" type="text" placeholder="City" aria-required="true" required oninput="onAddressInputChange()" onkeydown="onEnterVerify(event)" />
                </div>
                <div style="margin-left:16px;">
                  <label class="subtle" for="addr_state" style="display:block;">State / Province / Region <span class="req" aria-hidden="true">*</span></label>
                  <input id="addr_state" type="text" placeholder="State / Province / Region" aria-required="true" required oninput="onAddressInputChange()" onkeydown="onEnterVerify(event)" />
                </div>
              </div>
              <div class="row address-split" style="margin-top:10px; gap:13px;">
                <div style="margin-right:16px;">
                  <label class="subtle" for="addr_zip" style="display:block;">Postal / ZIP Code <span class="req" aria-hidden="true">*</span></label>
                  <input id="addr_zip" type="text" placeholder="Postal / ZIP Code" aria-required="true" required oninput="onAddressInputChange()" onkeydown="onEnterVerify(event)" />
                </div>
                <div style="margin-left:16px;">
                  <label class="subtle" for="addr_country" style="display:block;">Country <span class="req" aria-hidden="true">*</span></label>
                  <input id="addr_country" type="text" placeholder="Country" aria-required="true" required oninput="onAddressInputChange()" onkeydown="onEnterVerify(event)" />
                </div>
              </div>

              <label class="subtle" for="door" style="display:block; margin-top:8px;">Door Notes / Access Details</label>
              <input id="door" type="text" placeholder="Guard call, buzzer code, etc" onkeydown="onEnterVerify(event)" />
              <div style="margin-top:10px;">
                <button id="useLocationBtn" class="cta-secondary" style="width:100%;" onclick="useCurrentAddress()">Use Current Location</button>
              </div>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="showPlansBtn" class="cta cta-lg btn-disabled" style="flex:0 0 auto" onclick="processEligibility()">Check Availability</button>
            <div class="center">
              <button class="cta-secondary" style="width:100%;" onclick="goto('screen-welcome')">Back</button>
            </div>
          </div>
        </section>

        <!-- Processing screen removed -->

        <!-- Results Minimal -->
        <section id="screen-results-min" class="screen" aria-labelledby="results-min-title">
          <header id="results-min-title">Available plans at your address</header>
          <div class="content">
            <div>
              <span class="chip">Location verified</span>
              <span class="chip">Residential — FTTH</span>
              <span class="chip">Best for streaming</span>
              <span class="chip">₹1200–1500</span>
            </div>
            <article class="card" role="article" aria-labelledby="planA">
              <div class="plan" id="planA">Provider A · Stream Plus 200</div>
              <div class="price">₹1299 <span class="muted">/month</span></div>
              <div class="feat">200 Mbps • Unlimited • Router • ETA: 1–2 days</div>
              <div class="stack" style="margin-top:8px;">
                <span class="elig">✅ Available</span>
                <button class="cta" onclick="goto('screen-activate')">Activate now</button>
              </div>
            </article>
            <article class="card" role="article" aria-labelledby="planB">
              <div class="plan" id="planB">Provider B · Family 100</div>
              <div class="price">₹1099 <span class="muted">/month</span></div>
              <div class="feat">100 Mbps • Unlimited • Wi‑Fi 6 • ETA: 2–3 days</div>
              <div class="stack" style="margin-top:8px;">
                <span class="elig">⚠️ Partially available</span>
                <button class="cta-secondary" onclick="openCompare()">Compare Plans</button>
                <span class="link" onclick="goto('screen-plan-detail')">Details</span>
              </div>
            </article>
          </div>
          <div class="sticky">
            <button class="cta" style="flex:1" onclick="goto('screen-results-explore')">Switch to Exploratory</button>
          </div>
        </section>

        <!-- Results Exploratory -->
        <section id="screen-results-explore" class="screen" aria-labelledby="results-explore-title">
          <header id="results-explore-title">Explore & Compare</header>
          <div class="content">
            <div>
              <span class="chip">Location verified</span>
              <span class="chip">Residential — FTTH</span>
              <span class="chip">Best for streaming</span>
              <span class="chip">₹1200–1500</span>
            </div>
            <article class="card">
              <div class="plan">Provider A · Stream Plus 200</div>
              <div class="price">₹1299 <span class="muted">/month</span></div>
              <div class="feat">200 Mbps • Unlimited • Router • ETA: 1–2 days</div>
              <div class="muted" style="margin:6px 0;">Why recommended: matches budget; FTTH at your building; high streaming interest → CDN pack.</div>
              <div class="stack">
                <span class="elig">✅ Available</span>
                <button class="cta-secondary" onclick="openCompare()">Compare Plans</button>
                <button class="cta" onclick="goto('screen-activate')">Activate</button>
              </div>
            </article>
          </div>
          <div class="sticky">
            <button class="cta-secondary" style="flex:1" onclick="goto('screen-results-min')">Minimal</button>
            <button class="cta-secondary" style="flex:1">Bundles</button>
            <button class="cta-secondary" style="flex:1">Show ineligible</button>
          </div>
        </section>

        <!-- Plan Detail Modal -->
        <section id="screen-plan-detail" class="screen" aria-label="Plan details">
          <header>Plan details</header>
          <div class="content">
            <p class="muted">Provider A · Stream Plus 200</p>
            <p class="muted">Full T&Cs • Installation window by ZIP • Activation steps • Docs required • Cancellation • Early termination fees</p>
          </div>
          <div class="sticky">
            <button class="cta-secondary" style="flex:1" onclick="historyBack()">Back</button>
            <button class="cta" style="flex:1" onclick="goto('screen-activate')">Activate this plan</button>
          </div>
        </section>

        <!-- Activate -->
        <section id="screen-activate" class="screen" aria-labelledby="activate-title">
          <header id="activate-title">Activate now</header>
          <div class="content">
            <label class="subtle" for="name">Name</label>
            <input id="name" type="text" placeholder="Full name" />
            <label class="subtle" for="idup">ID upload (optional)</label>
            <input id="idup" type="text" placeholder="Upload link (mock)" />
            <label class="subtle" for="pay">Payment method</label>
            <select id="pay"><option>Card</option><option>UPI</option><option>Net Banking</option></select>
            <div class="row">
              <div>
                <label class="subtle" for="date">Date</label>
                <input id="date" type="date" />
              </div>
              <div>
                <label class="subtle" for="time">Time</label>
                <input id="time" type="time" />
              </div>
            </div>
            <p class="chip" aria-live="polite">Eligibility checks passed · credit approved</p>
          </div>
          <div class="sticky">
            <button class="cta" style="flex:1" onclick="goto('screen-confirm')">Confirm & Pay</button>
          </div>
        </section>

        <!-- Book Installation -->
        <section id="screen-book" class="screen">
          <header>Book installation</header>
          <div class="content">
            <label class="subtle" for="date2">Date</label>
            <input id="date2" type="date" />
            <label class="subtle" for="slot">Time slot</label>
            <select id="slot"><option>9–11 AM</option><option>12–2 PM</option><option>3–5 PM</option></select>
            <label class="subtle" for="tech">Technician availability</label>
            <select id="tech"><option>Available</option><option>Waitlist</option></select>
          </div>
          <div class="sticky">
            <button class="cta" style="flex:1" onclick="goto('screen-confirm')">Confirm booking</button>
          </div>
        </section>

        <!-- Chat -->
        <section id="screen-chat" class="screen">
          <header>Chat for help</header>
          <div class="content">
            <p class="muted">Context: Stream Plus 200 · Address verified · ETA 1–2d</p>
            <div class="card">You: Do you have a contract-free option?</div>
            <div class="card" style="background:var(--success-bg); border-color:var(--success-line)">Agent: Yes — Family 100 is contract-free. Add to compare?</div>
          </div>
          <div class="sticky">
            <input type="text" placeholder="Type a message…" aria-label="Message" />
          </div>
        </section>

        <!-- Confirm & Feedback -->
        <section id="screen-confirm" class="screen">
          <header>You're all set!</header>
          <div class="content">
            <p class="muted">Order #AB12345 • Activation by Dec 02 • Stream Plus 200</p>
            <div class="card">
              <div class="muted">Next steps: technician will contact you. Add to calendar • Share details • Save to profile.</div>
            </div>
            <div style="margin-top:8px;">
              <div class="muted">How easy was it to find a plan?</div>
              <div class="stars" role="radiogroup" aria-label="Rate experience">
                <span role="radio" aria-checked="true">★</span>
                <span role="radio" aria-checked="true">★</span>
                <span role="radio" aria-checked="true">★</span>
                <span role="radio" aria-checked="true">★</span>
                <span role="radio" aria-checked="false">☆</span>
              </div>
            </div>
            <textarea rows="4" placeholder="What helped / what was confusing? (optional)"></textarea>
          </div>
          <div class="sticky">
            <button class="cta" style="flex:1" onclick="goto('screen-entry')">Submit feedback</button>
          </div>
        </section>

        <!-- Compare Drawer -->
        <div id="overlay" class="overlay hidden" onclick="closeCompare()" aria-hidden="true"></div>
        <aside id="drawer" class="drawer hidden" aria-label="Comparison drawer">
          <div class="row" style="align-items:center; justify-content:center; margin-bottom:6px;">
            <div class="plan" style="text-align:center;">Compare Plan</div>
          </div>
          <!-- Comparison table -->
          <div class="card" style="padding:0;">
            <div class="cmp-scroll">
              <div>
                <div class="cmp-row cmp-head">
                  <div></div>
                  <div class="center" style="font-weight:800;">Fiber Pro Giga Plan</div>
                  <div class="center" style="font-weight:800;">Fiber 500</div>
                  <div class="center" style="font-weight:800;">Fiber 300</div>
                  <div class="center" style="font-weight:800;">Basic 100</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Download Speed</span></div>
                  <div class="cmp-val">Up to 1 Gbps</div>
                  <div class="cmp-val">Up to 500 Mbps</div>
                  <div class="cmp-subtle cmp-val">Up to 300 Mbps</div>
                  <div class="cmp-subtle cmp-val">Up to 100 Mbps</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Data Allowance</span></div>
                  <div class="cmp-val">Unlimited</div>
                  <div class="cmp-val">Unlimited</div>
                  <div class="cmp-subtle cmp-val">Unlimited</div>
                  <div class="cmp-subtle cmp-val">Unlimited</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Connected Devices</span></div>
                  <div class="cmp-subtle cmp-val">15+</div>
                  <div class="cmp-subtle cmp-val">5+</div>
                  <div class="cmp-val">10+</div>
                  <div class="cmp-subtle cmp-val">15+</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Streaming Quality</span></div>
                  <div class="cmp-val">4K UHD</div>
                  <div class="cmp-subtle cmp-val">HD</div>
                  <div class="cmp-subtle cmp-val">4K UHD</div>
                  <div class="cmp-subtle cmp-val">4K UHD</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Wi‑Fi Router</span></div>
                  <div class="cmp-yes cmp-val">✓</div>
                  <div class="cmp-yes cmp-val">✓</div>
                  <div class="cmp-yes cmp-val">✓</div>
                  <div class="cmp-no cmp-val">✗</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Free Streaming</span></div>
                  <div class="cmp-yes cmp-val">✓</div>
                  <div class="cmp-no cmp-val">✗</div>
                  <div class="cmp-no cmp-val">✗</div>
                  <div class="cmp-no cmp-val">✗</div>
                </div>
              </div>
            </div>
          </div>
          <div class="row" style="margin-top:10px;">
            <button class="cta" style="flex:1" onclick="closeCompare()">Close</button>
          </div>
        </aside>
      </div>
    </div>
    <script>
      const screens = Array.from(document.querySelectorAll('.screen'));
      let topPriorityOrder = [];
      let productPreference = null;
      let budgetChoice = null;
      let dataNeedChoice = null;
      let streamChoice = null;
      let linesChoice = null;
      let intlChoice = null;
      let lastAddress = { street:'', city:'', state:'', zip:'', country:'' };
      let currentPlan = null; // holds the last selected plan for review
      let modEstCost = 0; // estimated cost impact from Modify flow
      let isUpgradeFlow = false; // track if current flow is an upgrade
      let reviewBackTarget = 'screen-results-reco';
      function goto(id) {
        screens.forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0, 0);
        // Adjust phone scroll: disable on success to avoid vertical scroll
        const phoneEl = document.querySelector('.phone');
        if (phoneEl) {
          phoneEl.style.overflow = (id === 'screen-success') ? 'hidden' : 'auto';
        }
        if (id === 'screen-processing') refreshProcessingHero();
        if (id === 'screen-match') startMatchProgress();
        if (id === 'screen-results-reco') { updatePopularZip(); updateRecoWhySignals(); }
        if (id === 'screen-review') { populateReviewScreen(); }
      }
      function selectTopPriority(el, label) {
        // Single-select behavior: clear all, select one, remove rank badges
        const group = document.getElementById('priorityGroup1');
        Array.from(group.querySelectorAll('.chip-toggle')).forEach(chip => {
          chip.classList.remove('selected');
            chip.removeAttribute('data-rank');
        });
        el.classList.add('selected');
        topPriorityOrder = [label];
        tag('top_priority_updated:' + label);
        updateWelcomeCtaEnabled();
      }
      function selectProductPref(el, label) {
        const group = document.getElementById('preferenceGroup');
        Array.from(group.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        productPreference = label;
        tag('product_preference:' + label);
        updateWelcomeCtaEnabled();
      }
      function welcomeFindPlans() {
        if (!topPriorityOrder.length) {
          alert('Please select at least one intent to continue.');
          return;
        }
        tag('top_priorities_final:' + topPriorityOrder.join('|'));
        goto('screen-basics');
      }
      function updateWelcomeCtaEnabled() {
        const btn = document.getElementById('welcomeCta');
        if (!btn) return;
        if (topPriorityOrder.length) {
          btn.classList.remove('btn-disabled');
        } else {
          btn.classList.add('btn-disabled');
        }
      }
      function historyBack() {
        // Simple back to results-min
        goto('screen-results-min');
      }
      // Basics step state
      let basicsPrioritiesOrder = [];
      const basicsRangeTouched = { data: false, stream: false, budget: false };
      // Basics handlers
      function toggleBasicsPriority(el, label) {
        const idx = basicsPrioritiesOrder.indexOf(label);
        if (idx === -1) {
          basicsPrioritiesOrder.push(label);
          el.classList.add('selected');
        } else {
          basicsPrioritiesOrder.splice(idx, 1);
          el.classList.remove('selected');
        }
        // Update rank badges on chips
        const group = document.getElementById('basicsPriorityGroup');
        Array.from(group.querySelectorAll('.chip-toggle')).forEach(chip => {
          const lbl = chip.textContent.trim();
          const rank = basicsPrioritiesOrder.indexOf(lbl);
          if (rank >= 0) {
            chip.setAttribute('data-rank', String(rank + 1));
          } else {
            chip.removeAttribute('data-rank');
          }
        });
        tag('basics_priorities:' + basicsPrioritiesOrder.join('|'));
        basicsUpdateCtaEnabled();
      }
      function onBasicsRangeInput(rangeId, outId, suffix, prefix, tipId) {
        const el = document.getElementById(rangeId);
        const out = outId ? document.getElementById(outId) : null;
        if (!el) return;
        const val = el.value;
        const pre = prefix || '';
        const suf = suffix || '';
        const text = pre + val + suf;
        if (out) out.textContent = text;
        if (tipId) {
          const tip = document.getElementById(tipId);
          if (tip) tip.textContent = text;
        }
        // update gradient fill for styled-range sliders
        updateRangeFill(el);
        // mark as touched and re-evaluate CTA
        if (rangeId === 'basicsData') basicsRangeTouched.data = true;
        if (rangeId === 'basicsStream') basicsRangeTouched.stream = true;
        if (rangeId === 'basicsBudget') basicsRangeTouched.budget = true;
        basicsUpdateCtaEnabled();
        // Co‑design slider should recompute totals live
        if (rangeId === 'cdDataRange' && typeof updateCdTotals === 'function') {
          updateCdTotals();
        }
      }
      function basicsUpdateCtaEnabled() {
        const btn = document.getElementById('basicsCta');
        if (!btn) return;
        const allAnswered =
          basicsPrioritiesOrder.length > 0 &&
          basicsRangeTouched.data &&
          basicsRangeTouched.stream &&
          basicsRangeTouched.budget;
        btn.classList.toggle('btn-disabled', !allAnswered);
      }
      function importBill() {
        alert('Import Bill (mock):\n• Upload PDF/Image\n• Use Camera\n• Connect Provider');
        tag('import_bill_opened');
      }
      function basicsBack() {
        goto('screen-welcome');
      }
      function basicsContinue() {
        // Persist simple tags and continue to address screen
        const planTxt = (document.getElementById('basicsPlanDesc')?.value || '').trim();
        if (basicsPrioritiesOrder.length) tag('basics_priorities_final:' + basicsPrioritiesOrder.join('|'));
        const dataVal = document.getElementById('basicsData')?.value;
        const streamVal = document.getElementById('basicsStream')?.value;
        const budgetVal = document.getElementById('basicsBudget')?.value;
        if (dataVal != null) tag('basics_data_gb:' + dataVal);
        if (streamVal != null) tag('basics_stream_hrs:' + streamVal);
        if (budgetVal != null) tag('basics_budget_usd:' + budgetVal);
        if (planTxt) tag('basics_plan_text');
        const finance = !!document.getElementById('basicsFinance')?.checked;
        const port = !!document.getElementById('basicsPort')?.checked;
        if (finance) tag('include_financing:true');
        if (port) tag('port_number:true');
        goto('screen-match');
      }
      // Auto-fill Basics via AI user analysis
      function basicsAskAiAnalysis() {
        const recommendedOrder = ['Cost', 'Performance', 'Flexible Contract'];
        // Reset and apply chip selections with rank badges
        basicsPrioritiesOrder = [];
        const group = document.getElementById('basicsPriorityGroup');
        if (group) {
          const chips = Array.from(group.querySelectorAll('.chip-toggle'));
          chips.forEach(chip => {
            chip.classList.remove('selected');
            chip.removeAttribute('data-rank');
          });
          recommendedOrder.forEach((label, idx) => {
            const chip = chips.find(c => c.textContent.trim() === label);
            if (chip) {
              basicsPrioritiesOrder.push(label);
              chip.classList.add('selected');
              chip.setAttribute('data-rank', String(idx + 1));
            }
          });
        }
        // Populate sliders with inferred usage
        const setRange = (id, value, outId, suffix, prefix) => {
          const el = document.getElementById(id);
          if (el) {
            el.value = value;
            onBasicsRangeInput(id, outId, suffix, prefix);
          }
        };
        setRange('basicsData', 85, 'basicsDataVal', ' GB');
        setRange('basicsStream', 120, 'basicsStreamVal', ' hrs');
        setRange('basicsBudget', 60, 'basicsBudgetVal', '', '$');
        // Checkboxes inferred from behavior
        const financeEl = document.getElementById('basicsFinance');
        const portEl = document.getElementById('basicsPort');
        if (financeEl) financeEl.checked = true;
        if (portEl) portEl.checked = true;
        // Fill Describe Current Plan
        const planInput = document.getElementById('basicsPlanDesc');
        if (planInput) {
          planInput.value = 'Provider X • 500mbps • $70/mo';
        }
        // Ensure CTA enabled
        basicsRangeTouched.data = true;
        basicsRangeTouched.stream = true;
        basicsRangeTouched.budget = true;
        basicsUpdateCtaEnabled();
        tag('basics_ai_autofill_applied');
        // Disable the Ask AI button after auto-population
        const aiBtn = document.getElementById('basicsAiBtn');
        if (aiBtn) {
          aiBtn.classList.add('btn-disabled');
          aiBtn.setAttribute('aria-disabled', 'true');
        }
      }
      function permissionLocation() {
        alert('Location permission mocked. Using coarse location.\nYou can also enter address manually.');
      }
      // Address screen interactivity
      let addressVerified = null; // true | false | null
      function onAddressInputChange() {
        const street = (document.getElementById('addr_street').value || '').trim();
        const showBtn = document.getElementById('showPlansBtn');
        if (street.length > 0) {
          showBtn.classList.remove('btn-disabled');
        } else {
          showBtn.classList.add('btn-disabled');
        }
      }
      function useCurrentAddress() {
        const useBtn = document.getElementById('useLocationBtn');
        const showBusy = (busy, label) => {
          if (!useBtn) return;
          if (busy) {
            useBtn.classList.add('btn-disabled');
            useBtn.textContent = 'Detecting location…';
          } else {
            useBtn.classList.remove('btn-disabled');
            useBtn.textContent = label || 'Use Current Location';
          }
        };
        const fillFields = ({ street, line2, city, state, zip, country }) => {
          document.getElementById('addr_street').value = street || '';
          document.getElementById('addr_line2').value = line2 || '';
          document.getElementById('addr_city').value = city || '';
          document.getElementById('addr_state').value = state || '';
          document.getElementById('addr_zip').value = zip || '';
          document.getElementById('addr_country').value = country || '';
          onAddressInputChange();
        };
        if (!navigator.geolocation) {
          permissionLocation();
          fillFields({ street: 'Current Location (mock)' });
          showBusy(false, 'Use Current Location');
          return;
        }
        showBusy(true);
        navigator.geolocation.getCurrentPosition(async (pos) => {
          try {
            const { latitude, longitude } = pos.coords;
            const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`;
            const resp = await fetch(url, { headers: { 'Accept': 'application/json' } });
            if (!resp.ok) throw new Error('reverse geocode failed');
            const data = await resp.json();
            const a = data.address || {};
            // Try multiple candidates for street to maximize fill success
            const streetCandidate1 = [a.house_number, a.road].filter(Boolean).join(' ').trim();
            const streetCandidate2 = a.road;
            const streetCandidate3 = a.residential || a.pedestrian || a.path || a.footway || a.neighbourhood || a.suburb;
            const streetCandidate4 = data.name;
            const streetCandidate5 = (data.display_name || '').split(',')[0]?.trim();
            const street = streetCandidate1 || streetCandidate2 || streetCandidate3 || streetCandidate4 || streetCandidate5 || '';
            const line2 = ''; // leave Address Line 2 empty for user input
            const city = a.city || a.town || a.village || a.hamlet || '';
            const state = a.state || '';
            const zip = a.postcode || '';
            const country = a.country || '';
            console.log('reverse-geocode result', { street, city, state, zip, country });
            fillFields({ street, line2, city, state, zip, country });
          } catch (e) {
            console.warn('Reverse geocoding failed:', e);
            fillFields({ street: 'Current Location (detected)' });
            showBusy(false, 'Use Current Location');
            return;
          }
          showBusy(false, 'Update Current location');
        }, (err) => {
          console.warn('Geolocation denied/unavailable:', err);
          permissionLocation();
          fillFields({ street: 'Current Location (mock)' });
          showBusy(false, 'Use Current Location');
        }, { enableHighAccuracy: true, timeout: 8000, maximumAge: 60000 });
      }
      function resetAddressScreen(fromCheckbox) {
        document.getElementById('addr_street').value = '';
        document.getElementById('addr_line2').value = '';
        document.getElementById('addr_city').value = '';
        document.getElementById('addr_state').value = '';
        document.getElementById('addr_zip').value = '';
        document.getElementById('addr_country').value = '';
        document.getElementById('door').value = '';
        onAddressInputChange();
        if (!fromCheckbox) goto('screen-basics');
      }
      function onEnterVerify(e) {
        if (e && e.key === 'Enter') processEligibility();
      }
      function tag(t) {
        console.log('signal:', t);
      }
      function processEligibility() {
        // Determine simple success/failure based on entered address data
        const street = (document.getElementById('addr_street')?.value || '').toLowerCase();
        const line2 = (document.getElementById('addr_line2')?.value || '').toLowerCase();
        const city = (document.getElementById('addr_city')?.value || '').toLowerCase();
        const state = (document.getElementById('addr_state')?.value || '').toLowerCase();
        const zip = (document.getElementById('addr_zip')?.value || '').toLowerCase();
        const country = (document.getElementById('addr_country')?.value || '').toLowerCase();
        const addrStr = [street, line2, city, state, zip, country].filter(Boolean).join(' ');
        const failed = addrStr.includes('000') || addrStr.includes('no ');
        lastAddress = { street, city, state, zip, country };

        goto('screen-processing');
        const ring = document.getElementById('ring');
        const ringLabel = document.getElementById('ringLabel');
        const eta = document.getElementById('etaSeconds');
        const badge = document.getElementById('resultBadge');
        const card = document.getElementById('failureCard');
        const plansBtn = document.getElementById('procShowPlansBtn');

        // reset UI state before starting
        if (badge) { badge.className = 'badge hidden'; badge.textContent = ''; }
        if (card) card.classList.add('hidden');
        if (plansBtn) plansBtn.classList.add('btn-disabled');

        let p = 0;
        let seconds = 3;
        let elapsedMs = 0;
        if (eta) eta.textContent = String(seconds);
        const t = setInterval(() => {
          p += 7; if (p > 100) p = 100;
          elapsedMs += 200;
          seconds = Math.max(0, 3 - Math.floor(elapsedMs / 1000));
          if (ring) ring.style.setProperty('--p', p);
          if (ringLabel) ringLabel.textContent = String(Math.round(p)) + '%';
          if (eta) eta.textContent = String(seconds);
          if (p >= 100) {
            clearInterval(t);
            // show result
            if (!failed) {
              if (badge) {
                badge.classList.remove('failure');
                badge.classList.add('success');
                badge.textContent = 'Great news! Service is available at your address.';
                badge.classList.remove('hidden');
              }
              if (plansBtn) plansBtn.classList.remove('btn-disabled');
              if (card) card.classList.add('hidden');
            } else {
              if (badge) {
                badge.classList.remove('success');
                badge.classList.add('failure');
                badge.textContent = 'Sorry, service is not yet available at this address.';
                badge.classList.remove('hidden');
              }
              if (plansBtn) plansBtn.classList.add('btn-disabled');
              if (card) card.classList.remove('hidden');
            }
          }
        }, 200);
      }
      function openCompare() {
        // Navigate to new compare screen
        goto('screen-compare');
        // ensure first tab is selected visually
        compareTab('s24');
      }
      function closeCompare() {
        goto('screen-results-reco');
      }
      let compareActiveKey = 's24';
      function compareTab(key) {
        const tabs = [['s24','cmp-s24','tab-s24'], ['iphone','cmp-iphone','tab-iphone'], ['pixel','cmp-pixel','tab-pixel']];
        const scroller = document.getElementById('compareScroller');
        tabs.forEach(([k, cardId, tabId]) => {
          const tab = document.getElementById(tabId);
          if (tab) tab.classList.toggle('selected', k === key);
          if (k === key) {
            const card = document.getElementById(cardId);
            if (card && scroller) card.scrollIntoView({ behavior: 'smooth', inline: 'center' });
          }
          const card = document.getElementById(cardId);
          if (card) {
            card.style.border = (k === key) ? '2px solid #401075' : '1px solid var(--line)';
          }
        });
        compareActiveKey = key;
      }
      function handleComparePick() {
        const map = { s24: 'Samsung Galaxy S24 FE', iphone: 'iPhone 17 Pro Max', pixel: 'Google Pixel 8a' };
        startCoDesign(map[compareActiveKey] || 'Samsung Galaxy S24 FE');
      }
      function handleCompareDetails() {
        const map = { s24: 'Samsung Galaxy S24 FE', iphone: 'iPhone 17 Pro Max', pixel: 'Google Pixel 8a' };
        const name = map[compareActiveKey] || 'Samsung Galaxy S24 FE';
        // Derive price from device pricing used in Co‑Design
        const pricingDevices = {
          'Samsung Galaxy S24 FE': { monthly: 55.00, upfront: 199.00 },
          'iPhone 17 Pro Max': { monthly: 115.00, upfront: 399.00 },
          'Google Pixel 8a': { monthly: 79.00, upfront: 0.00 },
        };
        const dev = pricingDevices[name] || pricingDevices['Samsung Galaxy S24 FE'];
        const priceStr = '$' + (Math.round(dev.monthly * 100) / 100).toFixed(2);
        // Pull the green pill label from the selected compare card (e.g., "Best Performance")
        const labelEl = document.querySelector(`#cmp-${compareActiveKey} .elig`);
        const recoLabel = (labelEl && labelEl.textContent) ? labelEl.textContent.trim() : 'Highly Recommended';
        try { sessionStorage.setItem('selectedDevice', name); } catch(e) {}
        try { sessionStorage.setItem('compareRecoLabel', recoLabel); } catch(e) {}
        // Feed into plan view; override pill label and keep it green
        viewPlan(name, null, null, priceStr, 'Unlimited', '', '', '', '', '', undefined, undefined, recoLabel, 'pill pill-high');
      }
      // Consent modal handlers
      function openConsent() {
        const ov = document.getElementById('consentOverlay');
        const md = document.getElementById('consentModal');
        // Ensure modal nodes are direct children of the phone frame
        const phone = document.querySelector('.phone');
        if (phone && ov && md) {
          if (ov.parentElement !== phone) phone.appendChild(ov);
          if (md.parentElement !== phone) phone.appendChild(md);
        }
        if (ov) ov.classList.remove('hidden');
        if (md) md.classList.remove('hidden');
        // prevent scroll
        if (phone) phone.style.overflow = 'hidden';
        // Hide codesign content behind to show only modal
        const cdContent = document.querySelector('#screen-codesign .content');
        const cdSticky = document.querySelector('#screen-codesign .cd-sticky');
        if (cdContent) cdContent.classList.add('hidden');
        if (cdSticky) cdSticky.classList.add('hidden');
        // Initialize consent state
        const strict = document.getElementById('chkStrict');
        const btn = document.getElementById('consentConfirmBtn');
        if (strict) strict.checked = false;
        if (btn) btn.classList.add('btn-disabled');
        if (strict) strict.addEventListener('change', onConsentChange);
      }
      function closeConsent() {
        const ov = document.getElementById('consentOverlay');
        const md = document.getElementById('consentModal');
        if (ov) ov.classList.add('hidden');
        if (md) md.classList.add('hidden');
        const phone = document.querySelector('.phone');
        if (phone) phone.style.overflow = 'auto';
        // Restore codesign content
        const cdContent = document.querySelector('#screen-codesign .content');
        const cdSticky = document.querySelector('#screen-codesign .cd-sticky');
        if (cdContent) cdContent.classList.remove('hidden');
        if (cdSticky) cdSticky.classList.remove('hidden');
        const strict = document.getElementById('chkStrict');
        if (strict) strict.removeEventListener('change', onConsentChange);
      }
      function onConsentChange() {
        const strict = document.getElementById('chkStrict');
        const btn = document.getElementById('consentConfirmBtn');
        const enabled = !!(strict && strict.checked);
        if (btn) btn.classList.toggle('btn-disabled', !enabled);
      }
      function confirmAdvisorReview() {
        // proceed to review with codesign snapshot
        closeConsent();
        openReview('screen-codesign');
      }
      /* Consent modal handlers removed */
      // Bust cache for address icon so latest asset always loads
      (function ensureFreshAddressIcon() {
        const img = document.getElementById('addressIcon');
        if (img) {
          const base = './assets/address-icon.svg';
          img.src = base + '?v=' + Date.now();
        }
      })();
      // Bust cache for personalize icon so latest asset always loads
      (function ensureFreshPersonalizeIcon() {
        const img = document.getElementById('personalizeIcon');
        if (img) {
          const base = './assets/your-icon.svg';
          img.src = base + '?v=' + Date.now();
        }
      })();
      // Bust cache for match search icon
      (function ensureFreshMatchSearchIcon() {
        const img = document.getElementById('matchSearchIcon');
        if (img) {
          const base = './assets/search-icon.svg';
          img.src = base + '?v=' + Date.now();
        }
      })();
      // Bust cache for top pick icon so latest asset always loads
      (function ensureFreshTopPickIcon() {
        const img = document.getElementById('topPickIcon');
        if (img) {
          const base = './assets/Toppick-icon.svg';
          img.src = base + '?v=' + Date.now();
        }
      })();
      /* Inline SVGs used for headers - no cache-bust needed */
      // Step 4 helpers
      function updateBudgetValue() {
        /* no-op; slider removed */
      }
      function updateDataNeedValue() {
        /* no-op; slider removed */
      }
      function selectStream(el, label) {
        const g = document.getElementById('qStreamGroup');
        Array.from(g.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        tag('stream_pref:' + label);
        streamChoice = label;
        updatePersonalizeCtaEnabled();
      }
      function updateLinesValue() {
        /* no-op; slider removed */
      }
      function selectBudget(el, label) {
        const g = document.getElementById('qBudgetGroup');
        Array.from(g.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        tag('budget:' + label);
        budgetChoice = label;
        updatePersonalizeCtaEnabled();
      }
      function selectDataNeed(el, label) {
        const g = document.getElementById('qDataGroup');
        Array.from(g.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        tag('data_need:' + label);
        dataNeedChoice = label;
        updatePersonalizeCtaEnabled();
      }
      function selectLinesChip(el, label) {
        const g = document.getElementById('qLinesGroup');
        Array.from(g.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        tag('lines:' + label);
        linesChoice = label;
        updatePersonalizeCtaEnabled();
      }
      function selectIntl(el, yes) {
        const g = document.getElementById('qIntlGroup');
        Array.from(g.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        tag('intl_usage:' + (yes ? 'yes' : 'no'));
        intlChoice = yes ? 'International: Yes' : 'International: No';
        updatePersonalizeCtaEnabled();
      }
      function updatePersonalizeCtaEnabled() {
        const btn = document.getElementById('personalizeCta');
        if (!btn) return;
        const anySelected = Boolean(budgetChoice || dataNeedChoice || streamChoice || linesChoice || (typeof intlChoice !== 'undefined' && intlChoice !== null));
        if (anySelected) {
          btn.classList.remove('btn-disabled');
        } else {
          btn.classList.add('btn-disabled');
        }
      }
      function updateRangeFill(el){
        if (!el) return;
        const min = Number(el.min || 0), max = Number(el.max || 100), val = Number(el.value || 0);
        const pct = ((val - min) * 100) / (max - min);
        el.style.setProperty('--val', pct + '%');
      }
      // Initialize range backgrounds on load
      document.addEventListener('DOMContentLoaded', () => {
        // Ensure all screens live inside the phone frame (guard against stray DOM moves)
        (function ensureScreensInsidePhone(){
          const phone = document.querySelector('.phone');
          if (!phone) return;
          document.querySelectorAll('.screen').forEach(screen => {
            if (!phone.contains(screen)) phone.appendChild(screen);
          });
        })();
        refreshProcessingHero();
        document.querySelectorAll('input.styled-range[type="range"]').forEach(updateRangeFill);
        // Restore selection and navigation state after refreshes
        const sel = sessionStorage.getItem('selectedDevice');
        if (sel) selectedDeviceName = sel;
        if (sessionStorage.getItem('gotoCodesign') === '1') {
          goto('screen-codesign');
          // clear one-time flag
          sessionStorage.removeItem('gotoCodesign');
        }
        if (sessionStorage.getItem('applyAiOptimise') === '1') {
          // Ensure we're on codesign and show button state
          const btn = document.getElementById('askAiBtn');
          if (btn) {
            btn.innerHTML = '<span aria-hidden="true" style="display:inline-flex; align-items:center; justify-content:center; margin-right:6px;">' +
              '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"#1e88ff\">' +
              '<path d=\"M12 2l2.2 7.1L21 11l-6.8 1.9L12 20l-2.2-7.1L3 11l6.8-1.9L12 2z\"/>' +
              '<path d=\"M19 2l1 3.2L23 6l-3 .8L19 10l-1-3.2L15 6l3-.8L19 2z\"/>' +
              '<path d=\"M5 3l1 3.2L9 7l-3 .8L5 11l-1-3.2L1 7l3-.8L5 3z\"/>' +
              '</svg></span>AI is Optimising…';
          }
          applyAiOptimisations();
          sessionStorage.removeItem('applyAiOptimise');
        }
        if (sessionStorage.getItem('resetDefaults') === '1') {
          // Reset fields to defaults
          const dataRange = document.getElementById('cdDataRange');
          if (dataRange) { dataRange.value = 50; onBasicsRangeInput('cdDataRange','cdDataValue',' GB'); }
          // Premium single-select default to first chip
          (function resetPremium() {
            const wrap = document.getElementById('cdPremium');
            if (!wrap) return;
            const first = wrap.querySelector('.chip');
            if (first) cdSingleSelect('cdPremium', first);
          })();
          // Clear boosters
          document.querySelectorAll('#cdDeviceRow ~ article.card .toolbar .chip').forEach(chip => chip.classList.remove('selected'));
          // Uncheck checkboxes
          ['cdTradeInChk','cdKeepDeviceChk','cdProtectChk','cdIntlChk','cdTotalSecChk','cdNoDownChk','cdRetailChk'].forEach(id => {
            const el = document.getElementById(id); if (el) el.checked = false;
          });
          // Tenure default to first chip
          (function resetTenure() {
            const wrap = document.getElementById('cdTenureChips');
            if (!wrap) return;
            const first = wrap.querySelector('.chip');
            if (first) cdSingleSelect('cdTenureChips', first);
          })();
          sessionStorage.removeItem('resetDefaults');
        }
      });
      // Bust cache and set up fallback for processing hero
      function refreshProcessingHero() {
        const img = document.getElementById('processingHero');
        const fb = document.getElementById('processingFallback');
        if (!img) return;
        img.onerror = () => { img.style.display = 'none'; if (fb) fb.classList.remove('hidden'); };
        img.onload = () => { img.style.display = 'block'; if (fb) fb.classList.add('hidden'); };
        const base = './assets/processing-hero.svg';
        img.src = base + '?v=' + Date.now();
      }
      /* processing meta not used in original flow */
      // Step 5 progress
      function startMatchProgress() {
        const fill = document.getElementById('matchFill');
        const label = document.getElementById('matchPctLabel');
        const chips = document.getElementById('matchChips');
        if (!fill || !label) return;
        fill.style.width = '0%';
        label.textContent = '0%';
        // build meta chips
        if (chips) {
          const items = [];
          // From Welcome
          if (topPriorityOrder && topPriorityOrder.length) items.push(...topPriorityOrder.slice(0, 4));
          // From Basics screen priorities
          if (typeof basicsPrioritiesOrder !== 'undefined' && basicsPrioritiesOrder && basicsPrioritiesOrder.length) {
            items.push(...basicsPrioritiesOrder.slice(0, 3));
          }
          // From Basics sliders
          const dataVal = document.getElementById('basicsData')?.value;
          const streamVal = document.getElementById('basicsStream')?.value;
          const budgetVal = document.getElementById('basicsBudget')?.value;
          if (dataVal != null) items.push(dataVal + 'GB/mo');
          if (streamVal != null) items.push(streamVal + 'hrs streaming');
          if (budgetVal != null) items.push('$' + budgetVal + ' budget');
          // From Basics toggles
          if (document.getElementById('basicsFinance')?.checked) items.push('Device financing');
          if (document.getElementById('basicsPort')?.checked) items.push('Port number');
          chips.innerHTML = items.map(t => '<span class="chip">' + t.replace(/</g,'&lt;') + '</span>').join('');
        }
        let p = 0;
        const t = setInterval(() => {
          p += 3;
          if (p > 100) p = 100;
          fill.style.width = p + '%';
          label.textContent = p + '%';
          if (p >= 100) {
            clearInterval(t);
            setTimeout(() => goto('screen-results-reco'), 400);
          }
        }, 80);
      }
      // Co‑design selection state
      let selectedDeviceName = null;
      function startCoDesign(name) {
        selectedDeviceName = name || selectedDeviceName || 'Samsung Galaxy S24 FE';
        // Persist choice for refresh-safe flows
        try { sessionStorage.setItem('selectedDevice', selectedDeviceName); } catch(e) {}
        // Show AI Optimising screen first, then auto-apply optimisations and navigate to Co‑Design
        goto('screen-ai');
        startAiLoading();
      }
      function renderCodesignDevices() {
        const map = {
          'Samsung Galaxy S24 FE': { card: 'card-s24', btn: 'btn-s24', badge: 'sel-s24', monthly: 55.00, upfront: 199.00 },
          'iPhone 17 Pro Max': { card: 'card-iphone', btn: 'btn-iphone', badge: 'sel-iphone', monthly: 115.00, upfront: 399.00 },
          'Google Pixel 8a': { card: 'card-pixel', btn: 'btn-pixel', badge: 'sel-pixel', monthly: 79.00, upfront: 0.00 }
        };
        Object.keys(map).forEach(name => {
          const { card, btn, badge } = map[name];
          const cardEl = document.getElementById(card);
          const btnEl = document.getElementById(btn);
          const badgeEl = document.getElementById(badge);
          if (!cardEl || !btnEl) return;
          if (name === (selectedDeviceName || 'Samsung Galaxy S24 FE')) {
            cardEl.style.border = '2px solid #401075';
            btnEl.className = 'cta';
            btnEl.textContent = 'Selected';
            if (badgeEl) badgeEl.style.display = 'flex';
          } else {
            cardEl.style.border = '1px solid var(--line)';
            btnEl.className = 'cta-secondary';
            btnEl.textContent = 'Select';
            if (badgeEl) badgeEl.style.display = 'none';
          }
        });
        // Update monthly/total summaries (base), then apply live adjustments
        const sel = map[selectedDeviceName || 'Samsung Galaxy S24 FE'];
        const monEl = document.getElementById('cdMonthlyEstimate');
        const totEl = document.getElementById('cdTotalForecast');
        if (sel && monEl && totEl) {
          const fmt = (n) => '$' + n.toFixed(2);
          monEl.innerHTML = fmt(sel.monthly) + '<span class="muted">/mo</span>';
          const total = sel.upfront + sel.monthly * 24;
          totEl.textContent = fmt(total);
        }
        if (typeof updateCdTotals === 'function') updateCdTotals();
      }
      function cdFindChip(containerId, text) {
        const wrap = document.getElementById(containerId);
        if (!wrap) return null;
        const chips = Array.from(wrap.querySelectorAll('.chip'));
        return chips.find(c => c.textContent.trim().toLowerCase() === text.trim().toLowerCase()) || null;
      }
      function cdEnsureSelected(containerId, text) {
        const chip = cdFindChip(containerId, text);
        if (!chip) return;
        if (chip.classList.contains('selected')) return;
        // For single-select containers, clear others
        if (containerId === 'cdPremium' || containerId === 'cdTenureChips') {
          cdSingleSelect(containerId, chip);
        } else {
          chip.classList.add('selected');
        }
      }
      function applyAiOptimisations() {
        const dataRange = document.getElementById('cdDataRange');
        if (dataRange) { dataRange.value = 85; onBasicsRangeInput('cdDataRange','cdDataValue',' GB'); }
        cdEnsureSelected('cdPremium', 'Upgrade to Unlimited 5G+');
        const boosters = Array.from(document.querySelectorAll('#cdDeviceRow ~ article.card .toolbar .chip'));
        boosters.forEach(chip => {
          const label = chip.textContent.trim();
          if (label === 'Extra Data' || label === 'Hotspot 10GB') chip.classList.add('selected');
        });
        const trade = document.getElementById('cdTradeInChk');
        const keep = document.getElementById('cdKeepDeviceChk');
        if (trade) trade.checked = true;
        if (keep) keep.checked = false;
        const prot = document.getElementById('cdProtectChk');
        const intl = document.getElementById('cdIntlChk');
        const totSec = document.getElementById('cdTotalSecChk');
        if (prot) prot.checked = true;
        if (intl) intl.checked = false;
        if (totSec) totSec.checked = true;
        cdEnsureSelected('cdTenureChips', '24 months');
        const noDown = document.getElementById('cdNoDownChk');
        const retail = document.getElementById('cdRetailChk');
        if (noDown) noDown.checked = true;
        if (retail) retail.checked = false;
        // Restore button label to default
        setTimeout(setAskAiDefaultLabel, 0);
        if (typeof updateCdTotals === 'function') updateCdTotals();
      }
      function startAiLoading() {
        const fill = document.getElementById('aiFill');
        if (!fill) return;
        fill.style.width = '0%';
        let p = 0;
        const t = setInterval(() => {
          p += 20;
          if (p >= 100) { p = 100; clearInterval(t);
            // After 1s, flag optimise + navigate back via refresh
            sessionStorage.setItem('applyAiOptimise','1');
            sessionStorage.setItem('gotoCodesign','1');
            if (selectedDeviceName) sessionStorage.setItem('selectedDevice', selectedDeviceName);
            window.location.reload();
          }
          fill.style.width = p + '%';
        }, 200); // ~1s total
      }
      function askAiOptimize() {
        const btn = document.getElementById('askAiBtn');
        if (btn) {
          btn.innerHTML = '<span aria-hidden=\"true\" style=\"display:inline-flex; align-items:center; justify-content:center; margin-right:6px;\">' +
            '<img src=\"./assets/sparkle-icon.svg\" alt=\"\" width=\"18\" height=\"18\"/></span>AI is Optimising…';
        }
        goto('screen-ai');
        startAiLoading();
      }
      /* openAssistant removed */
      function setAskAiDefaultLabel() {
        const btn = document.getElementById('askAiBtn');
        if (!btn) return;
        btn.innerHTML = '<span aria-hidden="true" style="display:inline-flex; align-items:center; justify-content:center; margin-right:6px;">' +
          '<img src="./assets/sparkle-icon.svg" alt="" width="18" height="18"/></span>Ask AI to Optimise';
      }
      function selectCdDeviceCard(name) {
        selectedDeviceName = name;
        // Persist selection and request a refresh with defaults
        sessionStorage.setItem('selectedDevice', selectedDeviceName);
        sessionStorage.setItem('gotoCodesign','1');
        // Auto-fill for the newly selected product
        sessionStorage.setItem('applyAiOptimise','1');
        window.location.reload();
      }
      function cdSingleSelect(containerId, el) {
        const wrap = document.getElementById(containerId);
        if (!wrap) return;
        const chips = wrap.querySelectorAll('.chip');
        chips.forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        if (typeof updateCdTotals === 'function') updateCdTotals();
      }
      function cdToggle(el) {
        el.classList.toggle('selected');
        if (typeof updateCdTotals === 'function') updateCdTotals();
      }
      function cdUpdateDataUsage() {
        const r = document.getElementById('cdDataRange');
        const out = document.getElementById('cdDataValue');
        if (!r || !out) return;
        out.textContent = r.value + 'GB';
      }
      // render selection when entering codesign
      (function observeGoto() {
        const _goto = goto;
        goto = function(id) {
          _goto(id);
          if (id === 'screen-codesign') {
            renderCodesignDevices();
            onBasicsRangeInput('cdDataRange','cdDataValue',' GB');
            // ensure the Co‑Design sticky is visible
            const cdSticky = document.querySelector('#screen-codesign .cd-sticky');
            if (cdSticky) cdSticky.style.display = 'flex';
            // Attach change listeners for checkboxes that affect totals
            ['cdTradeInChk','cdKeepDeviceChk','cdProtectChk','cdIntlChk','cdTotalSecChk','cdNoDownChk','cdRetailChk'].forEach(id => {
              const el = document.getElementById(id);
              if (el && !el._boundUpdateTotals) {
                el.addEventListener('change', () => { if (typeof updateCdTotals==='function') updateCdTotals(); });
                el._boundUpdateTotals = true;
              }
            });
            if (typeof updateCdTotals === 'function') updateCdTotals();
          } else {
            // hide Co‑Design sticky when navigating away
            const cdSticky = document.querySelector('#screen-codesign .cd-sticky');
            if (cdSticky) cdSticky.style.display = 'none';
          }
        }
      })();
      // Compute live totals for Co‑Design selections
      let cdLatest = { device:'Samsung Galaxy S24 FE', plan:'Upgrade to Unlimited 5G+', monthly:0, upfront:0, months:24 };
      function updateCdTotals() {
        const pricing = {
          devices: {
            'Samsung Galaxy S24 FE': { monthly: 55.00, upfront: 199.00 },
            'iPhone 17 Pro Max': { monthly: 115.00, upfront: 399.00 },
            'Google Pixel 8a': { monthly: 79.00, upfront: 0.00 },
          },
          premium: {
            'Upgrade to Unlimited 5G+': 20,
            'Premium 100GB': 10,
            'Standard 50GB': 0
          },
          boosters: {
            'Extra Data': 5,
            'Hotspot 10GB': 7,
            'Roaming Day Pass': 3
          },
          addons: {
            protect: 8,
            intl: 10,
            totalSec: 12
          },
          tradeInCredit: 100
        };
        const dev = pricing.devices[selectedDeviceName || 'Samsung Galaxy S24 FE'] || pricing.devices['Samsung Galaxy S24 FE'];
        let monthly = dev.monthly;
        let upfront = dev.upfront;
        // Premium plan uplift
        const premiumSel = document.querySelector('#cdPremium .chip.selected');
        if (premiumSel) {
          const add = pricing.premium[premiumSel.textContent.trim()] ?? 0;
          monthly += add;
        }
        // Data usage influence (mild)
        const dataVal = Number(document.getElementById('cdDataRange')?.value || 0);
        if (dataVal >= 150) monthly += 10;
        else if (dataVal >= 100) monthly += 5;
        // Boosters
        const planArticle = document.querySelector('article[aria-label="Plan section"]');
        if (planArticle) {
          Object.entries(pricing.boosters).forEach(([label, add]) => {
            const chip = Array.from(planArticle.querySelectorAll('.chip')).find(c => c.textContent.trim() === label);
            if (chip && chip.classList.contains('selected')) monthly += add;
          });
        }
        // Add-ons
        if (document.getElementById('cdProtectChk')?.checked) monthly += pricing.addons.protect;
        if (document.getElementById('cdIntlChk')?.checked) monthly += pricing.addons.intl;
        if (document.getElementById('cdTotalSecChk')?.checked) monthly += pricing.addons.totalSec;
        // Device options
        const trade = !!document.getElementById('cdTradeInChk')?.checked;
        const keep = !!document.getElementById('cdKeepDeviceChk')?.checked;
        if (trade) upfront = Math.max(0, upfront - pricing.tradeInCredit);
        if (keep) upfront = 0;
        // Financing
        const tenureChip = document.querySelector('#cdTenureChips .chip.selected');
        const months = parseInt((tenureChip?.textContent || '').replace(/\D/g,'')) || 24;
        const noDown = !!document.getElementById('cdNoDownChk')?.checked;
        if (noDown) {
          monthly += upfront / months;
          upfront = 0;
        }
        const fmt = (n) => '$' + (Math.round(n * 100) / 100).toFixed(2);
        const monEl = document.getElementById('cdMonthlyEstimate');
        const totEl = document.getElementById('cdTotalForecast');
        if (monEl) monEl.innerHTML = fmt(monthly) + '<span class="muted">/mo</span>';
        if (totEl) totEl.textContent = fmt(upfront + monthly * months);
        // Save latest snapshot for review
        cdLatest = {
          device: selectedDeviceName || 'Samsung Galaxy S24 FE',
          plan: premiumSel ? premiumSel.textContent.trim() : 'Standard 50GB',
          monthly,
          upfront,
          months
        };
      }
      // Co-Design helpers
      let cdBaseMonthly = 55;
      let cdBaseUpfront = 199;
      function openCoDesign(name, monthly, upfront, plan) {
        // Auto-select first device by default ($0 upfront / $41.62 monthly)
        cdBaseMonthly = 41.62;
        cdBaseUpfront = 0;
        const dev = document.getElementById('cdDeviceName');
        const upLabel = document.getElementById('cdUpfrontLabel');
        const mLabel = document.getElementById('cdMonthlyLabel');
        const trade = document.getElementById('cdTradeVal');
        if (dev) dev.textContent = 'iPhone 15 Pro';
        if (upLabel) upLabel.textContent = '$0.00';
        if (mLabel) mLabel.textContent = '$41.62';
        if (trade) trade.value = '0';
        // reset add-ons (warranty ON by default)
        const ins = document.getElementById('addonIns'); if (ins) ins.checked = false;
        const war = document.getElementById('addonWar'); if (war) war.checked = true;
        const acc = document.getElementById('addonAcc'); if (acc) acc.checked = false;
        computeCoDesign();
        goto('screen-codesign');
      }
      function selectCdDevice(name, upfront, monthly) {
        openCoDesign(name, monthly, upfront);
      }
      function computeCoDesign() {
        const ins = document.getElementById('addonIns')?.checked ? 15 : 0;
        const war = document.getElementById('addonWar')?.checked ? 5 : 0;
        const acc = document.getElementById('addonAcc')?.checked ? 4 : 0;
        const addOns = ins + war + acc;
        const trade = Number(document.getElementById('cdTradeVal')?.value || 0);
        const monthlyTotal = cdBaseMonthly + addOns;
        const dueToday = Math.max(0, cdBaseUpfront - trade);
        const fmt = (x) => '$' + (Math.round(x * 100) / 100).toFixed(2);
        const mt = document.getElementById('cdMonthlyTotal');
        const dt = document.getElementById('cdDueToday');
        if (mt) mt.innerHTML = fmt(monthlyTotal) + '<span class="muted">/mo</span>';
        if (dt) dt.textContent = fmt(dueToday);
        const upLabel = document.getElementById('cdUpfrontLabel');
        const mLabel = document.getElementById('cdMonthlyLabel');
        if (upLabel) upLabel.textContent = fmt(cdBaseUpfront);
        if (mLabel) mLabel.textContent = fmt(cdBaseMonthly);
      }
      function updatePopularZip() {
        const el = document.getElementById('popularZip');
        if (!el) return;
        const zip = (lastAddress.zip || '').toUpperCase();
        el.textContent = zip || 'YOUR ZIP';
      }
      function updateRecoWhySignals() {
        const zipEl = document.getElementById('whyZip');
        if (zipEl) {
          const zip = (lastAddress.zip || '').toUpperCase();
          zipEl.textContent = zip || 'YOUR ZIP';
        }
        const topEl = document.getElementById('whyTop');
        if (topEl) {
          const top = (topPriorityOrder && topPriorityOrder.length > 0) ? topPriorityOrder[0] : 'your top priority';
          topEl.textContent = top;
        }
        const prefEl = document.getElementById('whyPref');
        if (prefEl) {
          const pref = productPreference || 'your product preferences';
          prefEl.textContent = pref;
        }
      }
      function viewPlan(name, down, up, price, allowance, equipment, why1, why1sub, why2, why2sub) {
        const setText = (id, val, isHTML=false) => {
          const el = document.getElementById(id);
          if (!el) return;
          if (isHTML) el.innerHTML = val;
          else el.textContent = val;
        };
        // Helper to populate either normal or offer IDs if they exist
        const fillFor = (prefix) => {
          setText(prefix + 'Name', name || 'Plan');
          setText(prefix + 'Price', (price || '$0.00') + '<span class="muted">/mo</span>', true);
        };
        fillFor('pd');
        fillFor('pdO');
        // Pricing breakdown calculations
        const base = parseFloat(String(price || '').replace(/[^0-9.]/g, '')) || 0;
        const fmt = (n) => '$' + n.toFixed(2);
        const reg = 5.99;
        const taxApprox = base * 0.06;
        const totalEst = base + reg + taxApprox;
        const fillBreakdown = (prefix) => {
          setText(prefix + 'PriceRate', fmt(base) + ' per line', true);
          setText(prefix + 'RegFee', fmt(reg) + ' per line');
          setText(prefix + 'Tax', '~ 6% of base rate');
          setText(prefix + 'Total', fmt(totalEst));
          setText(prefix + 'ActFee', '$35.00 per line');
          setText(prefix + 'Install', 'Setup is free');
          setText(prefix + 'IncDown', (down ? down + ' Mbps' : ''));
          setText(prefix + 'IncUp', (up ? up + ' Mbps' : ''));
          setText(prefix + 'Allowance', allowance || 'Unlimited');
          setText(prefix + 'Equipment', equipment || 'Wi‑Fi Router');
          setText(prefix + 'Why1Title', why1 || 'Why point 1');
          setText(prefix + 'Why1Desc', why1sub || '');
          setText(prefix + 'Why2Title', why2 || 'Why point 2');
          setText(prefix + 'Why2Desc', why2sub || '');
        };
        fillBreakdown('pd');
        fillBreakdown('pdO');
        // Optional default for third why card
        setText('pdWhy3Title', 'Best Speed in Your Area');
        setText('pdWhy3Desc', 'Based on feasibility check');
        setText('pdOWhy3Title', 'Best Speed in Your Area');
        setText('pdOWhy3Desc', 'Based on feasibility check');
        // Set recommended pill based on selected product
        const pill = document.getElementById('pdRecoPill');
        if (pill) {
          // Optional args: reco pill label (12) and class (13)
          const recoLabelArg = arguments[12];
          const recoClassArg = arguments[13];
          if (typeof recoLabelArg !== 'undefined') {
            pill.className = recoClassArg || 'pill pill-high';
            pill.textContent = recoLabelArg;
          } else {
          const n = String(name || '').toLowerCase();
          let cls = 'pill pill-high';
          let label = 'Highly Recommended';
          if (n.includes('fiber 500') || n.includes('fiber 300')) {
            cls = 'pill pill-med';
            label = 'Medium Recommended';
          } else if (n.includes('basic 100') || n.includes('basic')) {
            cls = 'pill pill-low';
            label = 'Low Recommended';
          } else if (n.includes('giga')) {
            cls = 'pill pill-high';
            label = 'Highly Recommended';
          }
          pill.className = cls;
          pill.textContent = label;
          }
        }
        const pillO = document.getElementById('pdORecoPill');
        if (pillO) {
          const recoLabelArg = arguments[12];
          const recoClassArg = arguments[13];
          if (typeof recoLabelArg !== 'undefined') {
            pillO.className = recoClassArg || 'pill pill-high';
            pillO.textContent = recoLabelArg;
          } else {
          pillO.className = document.getElementById('pdRecoPill')?.className || pillO.className;
          pillO.textContent = document.getElementById('pdRecoPill')?.textContent || pillO.textContent;
          }
        }
        // Optional args: description (10) and ETA days (11)
        const desc = arguments[10];
        const etaDays = arguments[11];
        // Optional args: reco pill label (12) and class (13)
        const recoLabel = arguments[12];
        const recoClass = arguments[13];
        // Optional: target screen id (14)
        const targetScreen = arguments[14];
        const descEl = document.getElementById('pdDesc');
        if (descEl) {
          if (typeof desc !== 'undefined') {
            descEl.textContent = desc;
          } else {
            descEl.textContent = (down && up) ? (down + ' Mbps download • ' + up + ' Mbps upload') : '';
          }
        }
        const descElO = document.getElementById('pdODesc');
        if (descElO) {
          if (typeof desc !== 'undefined') {
            descElO.textContent = desc;
          } else {
            descElO.textContent = (down && up) ? (down + ' Mbps download • ' + up + ' Mbps upload') : '';
          }
        }
        const etaEl = document.getElementById('pdEta');
        if (etaEl) {
          if (typeof etaDays !== 'undefined') {
            etaEl.textContent = 'Activation ETA: ' + etaDays + ' days';
          }
        }
        const etaElO = document.getElementById('pdOEta');
        if (etaElO) {
          if (typeof etaDays !== 'undefined') {
            etaElO.textContent = 'Activation ETA: ' + etaDays + ' days';
          }
        }
        // cache selected plan for review screen (include reco pill meta if provided)
        currentPlan = { name, down, up, price, allowance, equipment, why1, why1sub, why2, why2sub, desc, etaDays, recoLabel, recoClass };
        // Ensure "Why this product for you?" is open by default
        const whyBody = document.getElementById('accWhyBody');
        const whyArrow = document.getElementById('accWhyArrow');
        if (whyBody && whyArrow) {
          whyBody.classList.remove('hidden');
          whyArrow.textContent = '▾';
        }
        const whyBodyO = document.getElementById('accWhyBodyO');
        const whyArrowO = document.getElementById('accWhyArrowO');
        if (whyBodyO && whyArrowO) {
          whyBodyO.classList.remove('hidden');
          whyArrowO.textContent = '▾';
        }
        // If navigating to offer details, derive "Why this product" points from the offer's rationale bullets
        if ((targetScreen || '') === 'screen-plan-offer') {
          const whyLis = Array.from(document.querySelectorAll('#offerWhyBody li')).map(li => (li.textContent || '').trim());
          const w1 = whyLis[0] || 'The system detected an increase in your data needs.';
          const w2 = whyLis[1] || 'This upgrade directly addresses your needs with Unlimited 5G+ and extra hotspot data.';
          const w3 = [whyLis[2], whyLis[3]].filter(Boolean).join(' ') || 'Timing is ideal with a limited‑time retention incentive.';
          // Titles summarizing each rationale
          setText('pdOWhy1Title', 'Rising Data Consumption');
          setText('pdOWhy1Desc', w1);
          setText('pdOWhy2Title', 'Offer Solves Your Need');
          setText('pdOWhy2Desc', w2);
          setText('pdOWhy3Title', 'Right Time to Upgrade');
          setText('pdOWhy3Desc', w3);
        }
        goto(targetScreen || 'screen-plan-full');
      }
      function openReview(sourceId) {
        reviewBackTarget = sourceId || reviewBackTarget;
        const hdr = document.getElementById('reviewTitleText');
        if (hdr) hdr.textContent = 'Review Your Bundle';
        const btn = document.getElementById('reviewConfirmBtn');
        if (btn) btn.textContent = 'Confirm & Proceed to Payment';
        isUpgradeFlow = false;
        // If coming from Co‑Design, apply current selections to review UI
        if (sourceId === 'screen-codesign') {
          const mapImg = {
            'Samsung Galaxy S24 FE': './assets/SamsungGalaxyS24FE.svg',
            'iPhone 17 Pro Max': './assets/iPhone17ProMax.svg',
            'Google Pixel 8a': './assets/GooglePixel8a.svg'
          };
          const fmt = (n) => '$' + (Math.round(n * 100) / 100).toFixed(2);
          const devName = document.getElementById('rvDeviceName');
          const devSub = document.getElementById('rvDeviceSub');
          const devImg = document.getElementById('rvDeviceImg');
          const planName = document.getElementById('rvPlanName');
          const planPrice = document.getElementById('rvPlanPrice');
          const monthlyBill = document.getElementById('rvMonthlyBill');
          const dueToday = document.getElementById('rvDueToday');
          if (devName) devName.textContent = cdLatest.device || 'Selected Device';
          if (devSub) devSub.textContent = ''; // optional subtitle
          if (devImg) devImg.src = mapImg[cdLatest.device] || devImg.src;
          if (planName) planName.textContent = cdLatest.plan || 'Plan';
          if (planPrice) planPrice.innerHTML = fmt(cdLatest.monthly) + '<span class="muted">/mo</span>';
          if (monthlyBill) monthlyBill.textContent = fmt(cdLatest.monthly);
          if (dueToday) dueToday.textContent = fmt(cdLatest.upfront);
        } else if (sourceId === 'screen-plan-full') {
          // Populate device from the last selected product (e.g., from Compare screen)
          const sel = (function() {
            try { return sessionStorage.getItem('selectedDevice'); } catch(e) { return null; }
          })() || selectedDeviceName || 'Samsung Galaxy S24 FE';
          const mapImg = {
            'Samsung Galaxy S24 FE': './assets/SamsungGalaxyS24FE.svg',
            'iPhone 17 Pro Max': './assets/iPhone17ProMax.svg',
            'Google Pixel 8a': './assets/GooglePixel8a.svg'
          };
          const devName = document.getElementById('rvDeviceName');
          const devSub = document.getElementById('rvDeviceSub');
          const devImg = document.getElementById('rvDeviceImg');
          if (devName) devName.textContent = sel;
          if (devSub) devSub.textContent = '';
          if (devImg) devImg.src = mapImg[sel] || devImg.src;
          // Also reflect the plan shown on plan-full if available
          if (currentPlan) {
            const planName = document.getElementById('rvPlanName');
            const planPrice = document.getElementById('rvPlanPrice');
            if (planName) planName.textContent = currentPlan.name || 'Plan';
            if (planPrice) planPrice.innerHTML = (currentPlan.price || '$0.00') + '<span class="muted">/mo</span>';
          }
        }
        goto('screen-review');
      }
      function openReviewUpgrade() {
        reviewBackTarget = 'screen-offer-special';
        const hdr = document.getElementById('reviewTitleText');
        if (hdr) hdr.textContent = 'Review your Upgrade';
        const btn = document.getElementById('reviewConfirmBtn');
        if (btn) btn.textContent = 'Confirm Upgrade & Proceed to Payment';
        isUpgradeFlow = true;
        goto('screen-review');
      }
      function historyBackReview() {
        goto(reviewBackTarget || 'screen-results-reco');
      }
      function populateReviewScreen() {
        if (!currentPlan) return;
        const setText = (id, val, isHTML=false) => {
          const el = document.getElementById(id);
          if (!el) return;
          if (isHTML) el.innerHTML = val;
          else el.textContent = val;
        };
        const { name, down, up, price, allowance, equipment, why1, why1sub, why2, why2sub, desc, etaDays, recoLabel, recoClass } = currentPlan;
        // Only apply plan name/price to the dedicated review fields if opening from Plan Details
        const planNameEl = document.getElementById('rvPlanName');
        const planPriceEl = document.getElementById('rvPlanPrice');
        const fromPlanFull = (reviewBackTarget === 'screen-plan-full');
        if (planNameEl && (fromPlanFull || planNameEl.textContent.trim() === 'Unlimited Plus')) {
          setText('rvPlanName', name || 'Plan');
        }
        if (planPriceEl && (fromPlanFull || planPriceEl.textContent.trim().startsWith('$75.00'))) {
          setText('rvPlanPrice', (price || '$0.00') + '<span class="muted">/mo</span>', true);
        }
        setText('rvDesc', (typeof desc !== 'undefined' ? desc : ((down && up) ? (down + ' Mbps download • ' + up + ' Mbps upload') : '')));
        const eta = document.getElementById('rvEta');
        if (eta) eta.textContent = (typeof etaDays !== 'undefined' ? ('Activation ETA: ' + etaDays + ' days') : '');
        const downUp = document.getElementById('rvIncDownUp');
        if (downUp) downUp.textContent = (down && up) ? (down + ' / ' + up + ' Mbps') : '';
        const allow = document.getElementById('rvAllowance');
        if (allow) allow.textContent = allowance || 'Unlimited';
        const equip = document.getElementById('rvEquipment');
        if (equip) equip.textContent = equipment || 'Wi‑Fi 6 Router';
        const pill = document.getElementById('rvRecoPill');
        if (pill) {
          if (recoLabel || recoClass) {
            if (recoClass) pill.className = recoClass;
            if (recoLabel) pill.textContent = recoLabel;
          } else {
            const n = String(name || '').toLowerCase();
            let cls = 'pill pill-high';
            let label = 'Highly Recommended';
            if (n.includes('fiber 500') || n.includes('fiber 300')) {
              cls = 'pill pill-med'; label = 'Medium Recommended';
            } else if (n.includes('basic 100') || n.includes('basic')) {
              cls = 'pill pill-low'; label = 'Low Recommended';
            }
            pill.className = cls;
            pill.textContent = label;
          }
        }
        computeReviewTotals();
      }
      function computeReviewTotals() {
        if (!currentPlan) return;
        const base = parseFloat(String(currentPlan.price || '').replace(/[^0-9.]/g, '')) || 0;
        const fmt = (n) => '$' + n.toFixed(2);
        const addSec = !!document.getElementById('rvAddSec')?.checked;
        const addIp = !!document.getElementById('rvAddIp')?.checked;
        const sec = addSec ? 5.00 : 0;
        const ip = addIp ? 10.00 : 0;
        const inst = 50.00;
        const monthly = base + sec + ip;
        const dueToday = inst;
        const set = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
        set('rvBase', fmt(base));
        set('rvSec', fmt(sec + ip)); // combined add-ons shown under Enhanced Security line
        set('rvInst', fmt(inst));
        set('rvMonthly', fmt(monthly));
        set('rvDueToday', fmt(dueToday));
      }
      function openCheckout() {
        if (!currentPlan) return;
        // compute totals using same logic + simple tax estimate
        const base = parseFloat(String(currentPlan.price || '').replace(/[^0-9.]/g, '')) || 0;
        const addSec = !!document.getElementById('rvAddSec')?.checked;
        const addIp = !!document.getElementById('rvAddIp')?.checked;
        const sec = addSec ? 5.00 : 0;
        const ip = addIp ? 10.00 : 0;
        const inst = 50.00;
        const monthly = base + sec + ip;
        const taxes = +(base * 0.06).toFixed(2);
        const dueToday = +(monthly + inst + taxes).toFixed(2);
        const fmt = (n) => '$' + n.toFixed(2);
        const setHTML = (id, html) => { const el = document.getElementById(id); if (el) el.innerHTML = html; };
        const setText = (id, txt) => { const el = document.getElementById(id); if (el) el.textContent = txt; };
        if (isUpgradeFlow) {
          setText('coPlanNameUp', (currentPlan?.name || 'Selected Plan'));
          setHTML('coPlanPriceUp', fmt(base) + '<span class="muted">/mo</span>');
          setText('coInstallUp', fmt(inst));
          setText('coTaxesUp', fmt(taxes));
          setText('coDueTodayUp', fmt(dueToday));
          goto('screen-checkout-upgrade');
        } else {
          setText('coPlanName', (currentPlan?.name || 'Selected Plan'));
          setHTML('coPlanPrice', fmt(base) + '<span class="muted">/mo</span>');
          setText('coInstall', fmt(inst));
          setText('coTaxes', fmt(taxes));
          setText('coDueToday', fmt(dueToday));
          const payBtn = document.getElementById('coPayBtn');
          if (payBtn) payBtn.textContent = 'Pay & Activate Plan';
          goto('screen-checkout');
        }
      }
      function openSuccess() {
        // Populate success details from the selected plan
        const setText = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
        const name = currentPlan?.name || 'Selected Plan';
        const speed = (currentPlan?.down ? 'Up to ' + currentPlan.down + ' Mbps' : '—');
        const today = new Date();
        const fmtDate = (d) => d.toLocaleDateString(undefined, { month:'short', day:'2-digit', year:'numeric' });
        const first = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate());
        if (isUpgradeFlow) {
          // Fill upgrade success
          setText('suUpPrev', 'Basic Plan');
          setText('suUpNew', name);
          setText('suUpEffective', fmtDate(first));
          goto('screen-success-upgrade');
        } else {
          setText('suPlan', name);
          setText('suSpeed', speed);
          setText('suActivation', fmtDate(today));
          setText('suFirstBill', fmtDate(first));
          const sub = document.getElementById('success-sub');
          if (sub) sub.textContent = 'Your ' + name + ' Plan is Active! Welcome aboard.';
          // Reset and render rating stars
          suRating = 0;
          renderSuStars();
          goto('screen-success');
        }
      }
      function toggleUpFeedbackChip(el) {
        el.classList.toggle('selected');
      }
      function toggleAccordion(section) {
        const map = {
          why: { body: 'accWhyBody', arrow: 'accWhyArrow' },
          inc: { body: 'accIncBody', arrow: 'accIncArrow' },
          price: { body: 'accPriceBody', arrow: 'accPriceArrow' }
        };
        const cfg = map[section];
        if (!cfg) return;
        const body = document.getElementById(cfg.body);
        const arrow = document.getElementById(cfg.arrow);
        if (!body || !arrow) return;
        const isHidden = body.classList.contains('hidden');
        if (isHidden) {
          body.classList.remove('hidden');
          arrow.textContent = '▾';
        } else {
          body.classList.add('hidden');
          arrow.textContent = '▸';
        }
      }
      function toggleWhyReco() {
        const body = document.getElementById('recoWhyBody');
        const arrow = document.getElementById('recoWhyArrow');
        if (!body || !arrow) return;
        const isHidden = body.classList.contains('hidden');
        if (isHidden) {
          body.classList.remove('hidden');
          arrow.textContent = '▾';
        } else {
          body.classList.add('hidden');
          arrow.textContent = '▸';
        }
      }
      function toggleOfferWhy() {
        const body = document.getElementById('offerWhyBody');
        const arrow = document.getElementById('offerWhyArrow');
        if (!body || !arrow) return;
        const isHidden = body.classList.contains('hidden');
        if (isHidden) {
          body.classList.remove('hidden');
          arrow.textContent = '▾';
        } else {
          body.classList.add('hidden');
          arrow.textContent = '▸';
        }
      }
      // Success screen: star rating
      let suRating = 0;
      function renderSuStars() {
        const stars = document.querySelectorAll('#suStars .star');
        if (!stars.length) return;
        stars.forEach((el, idx) => {
          el.textContent = (idx < suRating) ? '★' : '☆';
        });
      }
      function setStarRating(n) {
        suRating = n;
        renderSuStars();
      }
      // Upgrade feedback stars
      let suUpRating = 0;
      function renderSuStarsUp() {
        const stars = document.querySelectorAll('#suUpStars .star');
        if (!stars.length) return;
        stars.forEach((el, idx) => {
          el.textContent = (idx < suUpRating) ? '★' : '☆';
        });
      }
      function setStarRatingUp(n) {
        suUpRating = n;
        renderSuStarsUp();
      }
      // Helpers for dashboard accordions
      function setAccordionOpen(bodyId, arrowId, headerSel, open) {
        const body = document.getElementById(bodyId);
        const arrow = document.getElementById(arrowId);
        const header = headerSel ? document.querySelector(headerSel) : null;
        if (!body || !arrow) return;
        if (open) {
          body.classList.remove('hidden');
          arrow.textContent = '▾';
          if (header) header.setAttribute('aria-expanded', 'true');
        } else {
          body.classList.add('hidden');
          arrow.textContent = '▸';
          if (header) header.setAttribute('aria-expanded', 'false');
        }
      }
      function closeAllDashExcept(exceptKey) {
        const items = [
          { key: 'mybill', body: 'myBillBody', arrow: 'myBillArrow', headerSel: '#myBillCard [role="button"]' },
          { key: 'acc', body: 'accBody', arrow: 'accArrow', headerSel: '#accHealthCard [role="button"]' },
          { key: 'issues', body: 'issuesBody', arrow: 'issuesArrow', headerSel: '#openIssuesCard [role="button"]' },
          { key: 'offers', body: 'offersBody', arrow: 'offersArrow', headerSel: '#offersCard [role="button"]' },
        ];
        items.forEach(i => {
          if (i.key === 'offers') {
            // Always keep red-dot (offers) open
            setAccordionOpen(i.body, i.arrow, i.headerSel, true);
          } else if (i.key !== exceptKey) {
            setAccordionOpen(i.body, i.arrow, i.headerSel, false);
          }
        });
      }
      function toggleDash(section) {
        const map = {
          acc: { body: 'accBody', arrow: 'accArrow', headerSel: '#accHealthCard [role="button"]' },
          issues: { body: 'issuesBody', arrow: 'issuesArrow', headerSel: '#openIssuesCard [role="button"]' },
          offers: { body: 'offersBody', arrow: 'offersArrow', headerSel: '#offersCard [role="button"]' },
        };
        const cfg = map[section];
        if (!cfg) return;
        const body = document.getElementById(cfg.body);
        const arrow = document.getElementById(cfg.arrow);
        const header = document.querySelector(cfg.headerSel);
        if (!body || !arrow) return;
        const isHidden = body.classList.contains('hidden');
        if (section === 'offers') {
          // Keep offers permanently open
          setAccordionOpen(cfg.body, cfg.arrow, cfg.headerSel, true);
          return;
        }
        if (isHidden) {
          closeAllDashExcept(section);
          setAccordionOpen(cfg.body, cfg.arrow, cfg.headerSel, true);
        } else {
          setAccordionOpen(cfg.body, cfg.arrow, cfg.headerSel, false);
        }
      }
      function toggleMyBill() {
        const body = document.getElementById('myBillBody');
        const arrow = document.getElementById('myBillArrow');
        if (!body || !arrow) return;
        const isHidden = body.classList.contains('hidden');
        const header = document.querySelector('#myBillCard [role=\"button\"]');
        if (isHidden) {
          closeAllDashExcept('mybill');
          setAccordionOpen('myBillBody', 'myBillArrow', '#myBillCard [role=\"button\"]', true);
        } else {
          setAccordionOpen('myBillBody', 'myBillArrow', '#myBillCard [role=\"button\"]', false);
        }
      }
      // ---------- Modify Plan (Offer flow) ----------
      let modBoosterData = false;
      let modBoosterIntl = false;
      function openModifyPlan() {
        modBoosterData = false;
        modBoosterIntl = false;
        const slider = document.getElementById('modGbSlider');
        if (slider) slider.value = 20;
        const gb = document.getElementById('modGbVal');
        if (gb) gb.innerHTML = '20 <span class="muted" style="font-size:14px;">GB</span>';
        const b1 = document.getElementById('btnBoostData');
        const b2 = document.getElementById('btnBoostIntl');
        if (b1) { b1.textContent = 'Add +$10'; b1.style.background=''; b1.style.color=''; }
        if (b2) { b2.textContent = 'Add +$05'; b2.style.background=''; b2.style.color=''; }
        updateModifyEstimate();
        goto('screen-modify');
      }
      function onModifySlider(val) {
        const gb = document.getElementById('modGbVal');
        if (gb) gb.innerHTML = String(parseInt(val, 10)) + ' <span class="muted" style="font-size:14px;">GB</span>';
        updateModifyEstimate();
      }
      function toggleBooster(type) {
        if (type === 'data') modBoosterData = !modBoosterData;
        if (type === 'intl') modBoosterIntl = !modBoosterIntl;
        const b1 = document.getElementById('btnBoostData');
        const b2 = document.getElementById('btnBoostIntl');
        if (b1) {
          if (modBoosterData) { b1.textContent = 'Added +$10'; b1.style.background = '#401075'; b1.style.color = '#fff'; }
          else { b1.textContent = 'Add +$10'; b1.style.background = ''; b1.style.color=''; }
        }
        if (b2) {
          if (modBoosterIntl) { b2.textContent = 'Added +$05'; b2.style.background = '#401075'; b2.style.color = '#fff'; }
          else { b2.textContent = 'Add +$05'; b2.style.background = ''; b2.style.color=''; }
        }
        updateModifyEstimate();
      }
      function updateModifyEstimate() {
        // Base cost from slider: 10GB => $0, every +10GB adds $5.00
        const slider = document.getElementById('modGbSlider');
        const gbVal = slider ? parseInt(slider.value, 10) : 0;
        const baseCost = Math.max(0, ((gbVal - 10) / 10) * 5);
        const boosters = (modBoosterData ? 10 : 0) + (modBoosterIntl ? 5 : 0);
        const cost = baseCost + boosters;
        modEstCost = cost;
        const el = document.getElementById('modEst');
        if (el) el.innerHTML = '+$' + cost.toFixed(2) + '<span class=\"muted\">/mo</span>';
      }
      function confirmModify() {
        // Route to Review your Upgrade screen
        // Set review card price to reflect estimated cost impact
        currentPlan = {
          name: 'Plan Name',
          price: '$' + (modEstCost || 0).toFixed(2),
          allowance: 'Unlimited',
          equipment: 'Free Wi‑Fi 6 Router',
          desc: ''
        };
        openReviewUpgrade();
        // Set the back target to return to Modify screen
        reviewBackTarget = 'screen-modify';
      }
    </script>
  </body>
  </html>









